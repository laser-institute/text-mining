<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.553">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="LASER Institute">
<meta name="dcterms.date" content="2024-07-20">

<title>Lab 2: Dictionary Methods - Twitter Sentiment and School Reform</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="lab-2-case-study_files/libs/clipboard/clipboard.min.js"></script>
<script src="lab-2-case-study_files/libs/quarto-html/quarto.js"></script>
<script src="lab-2-case-study_files/libs/quarto-html/popper.min.js"></script>
<script src="lab-2-case-study_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="lab-2-case-study_files/libs/quarto-html/anchor.min.js"></script>
<link href="lab-2-case-study_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="lab-2-case-study_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="lab-2-case-study_files/libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="lab-2-case-study_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="lab-2-case-study_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="lab-2-case-study_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="lab-2-case-study_files/libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">0. INTRODUCTION</a>
  <ul>
  <li><a href="#walkthrough-focus" id="toc-walkthrough-focus" class="nav-link" data-scroll-target="#walkthrough-focus">Walkthrough Focus</a></li>
  </ul></li>
  <li><a href="#prepare" id="toc-prepare" class="nav-link" data-scroll-target="#prepare">1. PREPARE</a>
  <ul>
  <li><a href="#a.-some-context" id="toc-a.-some-context" class="nav-link" data-scroll-target="#a.-some-context">1a. Some Context</a>
  <ul class="collapse">
  <li><a href="#twitter-now-known-as-x-and-the-next-generation-science-standards" id="toc-twitter-now-known-as-x-and-the-next-generation-science-standards" class="nav-link" data-scroll-target="#twitter-now-known-as-x-and-the-next-generation-science-standards"><strong>Twitter (Now known as X) and the Next Generation Science Standards</strong></a></li>
  </ul></li>
  <li><a href="#b.-guiding-questions" id="toc-b.-guiding-questions" class="nav-link" data-scroll-target="#b.-guiding-questions">1b. Guiding Questions</a></li>
  <li><a href="#c.-set-up" id="toc-c.-set-up" class="nav-link" data-scroll-target="#c.-set-up">1c. Set Up</a></li>
  </ul></li>
  <li><a href="#wrangle" id="toc-wrangle" class="nav-link" data-scroll-target="#wrangle">2. WRANGLE</a>
  <ul>
  <li><a href="#a.-import-data" id="toc-a.-import-data" class="nav-link" data-scroll-target="#a.-import-data">2a. Import Data</a></li>
  <li><a href="#b.-tidy-text" id="toc-b.-tidy-text" class="nav-link" data-scroll-target="#b.-tidy-text">2b. Tidy Text</a>
  <ul class="collapse">
  <li><a href="#functions-used" id="toc-functions-used" class="nav-link" data-scroll-target="#functions-used">Functions Used</a></li>
  <li><a href="#subset-rows-columns" id="toc-subset-rows-columns" class="nav-link" data-scroll-target="#subset-rows-columns">Subset Rows &amp; Columns</a></li>
  <li><a href="#add-reorder-columns" id="toc-add-reorder-columns" class="nav-link" data-scroll-target="#add-reorder-columns">Add &amp; Reorder Columns</a></li>
  <li><a href="#combine-data-frames" id="toc-combine-data-frames" class="nav-link" data-scroll-target="#combine-data-frames">Combine Data Frames</a></li>
  <li><a href="#tokenize-text" id="toc-tokenize-text" class="nav-link" data-scroll-target="#tokenize-text">Tokenize Text</a></li>
  <li><a href="#remove-stop-words" id="toc-remove-stop-words" class="nav-link" data-scroll-target="#remove-stop-words">Remove Stop Words</a></li>
  <li><a href="#custom-stop-words" id="toc-custom-stop-words" class="nav-link" data-scroll-target="#custom-stop-words">Custom Stop Words</a></li>
  </ul></li>
  <li><a href="#c.-add-sentiment-values" id="toc-c.-add-sentiment-values" class="nav-link" data-scroll-target="#c.-add-sentiment-values">2c. Add Sentiment Values</a>
  <ul class="collapse">
  <li><a href="#get-sentiments" id="toc-get-sentiments" class="nav-link" data-scroll-target="#get-sentiments">Get Sentiments</a></li>
  <li><a href="#join-sentiments" id="toc-join-sentiments" class="nav-link" data-scroll-target="#join-sentiments">Join Sentiments</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#explore" id="toc-explore" class="nav-link" data-scroll-target="#explore">3. EXPLORE</a>
  <ul>
  <li><a href="#a.-time-series" id="toc-a.-time-series" class="nav-link" data-scroll-target="#a.-time-series">3a. Time Series</a></li>
  <li><a href="#b.-sentiment-summaries" id="toc-b.-sentiment-summaries" class="nav-link" data-scroll-target="#b.-sentiment-summaries">3b. Sentiment Summaries</a>
  <ul class="collapse">
  <li><a href="#sentiment-counts" id="toc-sentiment-counts" class="nav-link" data-scroll-target="#sentiment-counts">Sentiment Counts</a></li>
  <li><a href="#compute-sentiment-value" id="toc-compute-sentiment-value" class="nav-link" data-scroll-target="#compute-sentiment-value">Compute Sentiment Value</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#model" id="toc-model" class="nav-link" data-scroll-target="#model">4. MODEL</a></li>
  <li><a href="#communicate" id="toc-communicate" class="nav-link" data-scroll-target="#communicate">5. COMMUNICATE</a>
  <ul>
  <li><a href="#a.-select" id="toc-a.-select" class="nav-link" data-scroll-target="#a.-select">5a. Select</a></li>
  <li><a href="#b.-polish" id="toc-b.-polish" class="nav-link" data-scroll-target="#b.-polish">5b. Polish</a>
  <ul class="collapse">
  <li><a href="#ngss-sentiment" id="toc-ngss-sentiment" class="nav-link" data-scroll-target="#ngss-sentiment">NGSS Sentiment</a></li>
  <li><a href="#ngss-vs-ccss" id="toc-ngss-vs-ccss" class="nav-link" data-scroll-target="#ngss-vs-ccss">NGSS vs CCSS</a></li>
  </ul></li>
  <li><a href="#c.-narrate" id="toc-c.-narrate" class="nav-link" data-scroll-target="#c.-narrate">5c. Narrate</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Lab 2: Dictionary Methods - Twitter Sentiment and School Reform</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>LASER Institute </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">July 20, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">0. INTRODUCTION</h2>
<p>In this lab, our case study walkthrough is guided by my colleague Josh Rosenberg’s article, <strong>Advancing new methods for understanding public sentiment about educational reforms: The case of Twitter and the Next Generation Science Standards.</strong> We will focus on conducting a very simplistic “replication study” by comparing the sentiment of tweets about the <a href="https://www.nextgenscience.org">Next Generation Science Standards</a> (NGSS) and <a href="http://www.corestandards.org">Common Core State Standards</a> (CCSS) in order to better understand public reaction to these two curriculum reform efforts. I highly recommend you watch the quick 3-minute overview of this work at <a href="https://stanford.app.box.com/s/i5ixkj2b8dyy8q5j9o5ww4nafznb497x" class="uri">https://stanford.app.box.com/s/i5ixkj2b8dyy8q5j9o5ww4nafznb497x</a></p>
<section id="walkthrough-focus" class="level3">
<h3 class="anchored" data-anchor-id="walkthrough-focus">Walkthrough Focus</h3>
<p>For Lab 2, our focus will be on analyzing data from NGSS and CSSS posts and using sentiment lexicons to help gauge public opinion about those posts. Silge &amp; Robinson nicely illustrate the tools of text mining to approach the emotional content of text programmatically, in the following diagram:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="https://www.tidytextmining.com/sentiment.html#sentiment"><img src="img/sentiment-flow.png" title="Figure 2.1: A flowchart of a typical text analysis that uses tidytext for sentiment analysis. This chapter shows how to implement sentiment analysis using tidy data principles." class="img-fluid figure-img" style="width:90.0%" alt="Figure 2.1: A flowchart of a typical text analysis that uses tidytext for sentiment analysis."></a></p>
<figcaption>Figure 2.1: A flowchart of a typical text analysis that uses tidytext for sentiment analysis.</figcaption>
</figure>
</div>
<p>Our Lab 2 walkthrough will cover the following topics:</p>
<ol type="1">
<li><strong>Prepare</strong>: Prior to analysis, it’s critical to understand the context and data sources you’re working with so you can formulate useful and answerable questions. We’ll take a quick look at Dr.&nbsp;Rosenberg’s study as well as our datasets of interest .</li>
<li><strong>Wrangle</strong>: In section 2 we revisit tidying and tokenizing text from Lab 1, and learn some new functions for appending sentiment scores to our tweets using the AFFIN, bing, and nrc sentiment lexicons.</li>
<li><strong>Explore</strong>: In section 3, we use simple summary statistics and basic data visualization to compare sentiment between NGSS and CCSS tweets.</li>
<li><strong>Model</strong>: While we won’t leverage modeling approaches until Lab 3, we will examine the mixed effects model used by Rosenberg et al.&nbsp;to analyze the sentiment of tweets.</li>
<li><strong>Communicate:</strong> Finally, we’ll create a basic presentation, report, or other data product for sharing findings and insights from our analysis.</li>
</ol>
<hr>
</section>
</section>
<section id="prepare" class="level2">
<h2 class="anchored" data-anchor-id="prepare">1. PREPARE</h2>
<p>To help us better understand the context, questions, and data sources that we will be using in Lab 2, this section will focus on the following topics:</p>
<ol type="a">
<li><strong>Context</strong>. We take a quick look at the Rosenberg et al.&nbsp;(2021) article, <em>Advancing new methods for understanding public sentiment about educational reforms</em>, including the purpose of the study, questions explored, and findings.</li>
<li><strong>Questions.</strong> We’ll formulate some basic questions that we’ll use to guide our analysis, attempting to replicate some of the findings by Rosenberg et al.</li>
<li><strong>Set up</strong> We will set up a “home’ environment for the files and codes for lab 2.</li>
</ol>
<section id="a.-some-context" class="level3">
<h3 class="anchored" data-anchor-id="a.-some-context">1a. Some Context</h3>
<section id="twitter-now-known-as-x-and-the-next-generation-science-standards" class="level4">
<h4 class="anchored" data-anchor-id="twitter-now-known-as-x-and-the-next-generation-science-standards"><strong>Twitter (Now known as X) and the Next Generation Science Standards</strong></h4>
<p><img src="img/rosenberg.png" class="img-fluid" style="width:30.0%"></p>
<p><a href="https://osf.io/xymsd/.">Full Paper (Preprint)</a></p>
<p><strong>Abstract</strong></p>
<p>While the Next Generation Science Standards (NGSS) are a long-standing and widespread standards-based educational reform effort, they have received less public attention, and no studies have explored the sentiment of the views of multiple stakeholders toward them. To establish how public sentiment about this reform might be similar to or different from past efforts, we applied a suite of data science techniques to posts about the standards on Twitter from 2010-2020 (N = 571,378) from 87,719 users. Applying data science techniques to identify teachers and to estimate tweet sentiment, we found that the public sentiment towards the NGSS is overwhelmingly positive—33 times more so than for the CCSS. Mixed effects models indicated that sentiment became more positive over time and that teachers, in particular, showed a more positive sentiment towards the NGSS. We discuss implications for educational reform efforts and the use of data science methods for understanding their implementation.</p>
<p><strong>Data Source &amp; Analysis</strong></p>
<p>Similar to what we’ll be learning in this walkthrough, Rosenberg et al.&nbsp;used publicly accessible data from Twitter collected using the Full-Archive Twitter API and the <code>rtweet</code> package in R. Specifically, the authors accessed tweets and user information from the hashtag-based #NGSSchat online community, all tweets that included any of the following phrases, with “/” indicating an additional phrase featuring the respective plural form: “ngss”, “next generation science standard/s”, “next gen science standard/s”.</p>
<p>Unlike this walkthrough, however, the authors determined Tweet sentiment using the Java version of SentiStrength to assign tweets to two 5-point scales of sentiment, one for positivity and one for negativity, because SentiStrength is a validated measure for sentiment in short informal texts (Thelwall et al., 2011). In addition, we used this tool because Wang and Fikis (2019) used it to explore the sentiment of CCSS-related posts. We’ll be using the AFINN sentiment lexicon which also assigns words in a tweet to two 5-point scales, in addition to explore some other sentiment lexicons.</p>
<p>Note that the authors also used the <code>lme4</code> package in R to run a mixed effects model to determine if sentiment changes over time and differs between teachers and non-teacher. We will not attempt replicated that aspect of the analysis, but if you are interested in a guided walkthrough of how modeling can be used to understand changes in Twitter word use, see <a href="https://www.tidytextmining.com/twitter.html#changes-in-word-use">Chapter 7 of Text Mining with R</a>.</p>
<p><strong>Summary of Key Findings</strong></p>
<ol type="1">
<li>Contrasting with sentiment about CSSS, sentiment about the NGSS science education reform effort is overwhelmingly positive, with approximately 9 positive tweets for every negative tweet.</li>
<li>Teachers were more positive than non-teachers, and sentiment became substantially more positive over the ten years of NGSS-related posts.</li>
<li>Differences between the context of the tweets were small, but those that did not include the #NGSSchat hashtag became more positive over time than those posts that did not include the hashtag.</li>
<li>Individuals posted more tweets during #NGSSchat chats, the sentiment of their posts was more positive, suggesting that while the context of individual tweets has a small effect (with posts not including the hashtag becoming more positive over time), the effect upon individuals of being involved in the #NGSSchat was positive.</li>
</ol>
</section>
</section>
<section id="b.-guiding-questions" class="level3">
<h3 class="anchored" data-anchor-id="b.-guiding-questions">1b. Guiding Questions</h3>
<p>The Rosenberg et al.&nbsp;study was guided by the following five research questions:</p>
<ol type="1">
<li>What is the public sentiment expressed toward the NGSS?</li>
<li>How does sentiment for teachers differ from non-teachers?</li>
<li>How do tweets posted to #NGSSchat differ from those without the hashtag?</li>
<li>How does participation in #NGSSchat relate to the public sentiment individuals express?</li>
<li>How does public sentiment vary over time?</li>
</ol>
<p>For this walkthrough, we’ll use a similar approach used by the authors to gauge public sentiment around the NGSS, by compare how much more positive or negative NGSS tweets are relative to CSSS tweets.</p>
<p>Our (very) specific questions of interest for this walkthrough are:</p>
<ol type="1">
<li><strong>What is the public sentiment expressed toward the NGSS?</strong></li>
<li><strong>How does sentiment for NGSS compare to sentiment for CCSS?</strong></li>
</ol>
<p>And just to reiterate from Lab 1, one overarching question we’ll explore throughout this lab, and that Silge and Robinson (2018) identify as a central question to text mining and natural language processing, is:</p>
<blockquote class="blockquote">
<p>How do we to <strong>quantify</strong> what a document or collection of documents is about?</p>
</blockquote>
</section>
<section id="c.-set-up" class="level3">
<h3 class="anchored" data-anchor-id="c.-set-up">1c. Set Up</h3>
<p>As highlighted in <a href="https://datascienceineducation.com/c06.html">Chapter 6 of Data Science in Education Using R</a> (DSIEUR), one of the first steps of every workflow should be to set up a “Project” within RStudio. This will be your “home” for any files and code used or created in Lab 2. You are welcome to continue using the same project created for Lab 1, or create an entirely new project for Lab 2. However, after you’ve created your project open up a new R script, and load the following packages that we’ll be needing for this walkthrough:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rtweet)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(writexl)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidytext)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(textdata)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(textdata)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>I highly recommend that that you manually type the code shared throughout this walkthrough, for large blocks of text it may be easier to copy and paste.</p>
<hr>
</section>
</section>
<section id="wrangle" class="level2">
<h2 class="anchored" data-anchor-id="wrangle">2. WRANGLE</h2>
<p>In general, data wrangling involves some combination of cleaning, reshaping, transforming, and merging data (Wickham &amp; Grolemund, 2017). The importance of data wrangling is difficult to overstate, as it involves the initial steps of going from raw data to a dataset that can be explored and modeled (Krumm et al, 2018).</p>
<ol type="a">
<li><strong>Import Data</strong>. In this section, we will import and read data from excel to R environment.</li>
<li><strong>Tidy Tweets</strong>. We revisit the <code>tidytext</code> package to both “tidy” and tokenize our tweets in order to create our data frame for analysis.</li>
<li><strong>Get Sentiments</strong>. We conclude our data wrangling by introducing sentiment lexicons and the <code>inner_join()</code> function for appending sentiment values to our data frame.</li>
</ol>
<section id="a.-import-data" class="level3">
<h3 class="anchored" data-anchor-id="a.-import-data">2a. Import Data</h3>
<p>We’ll use the <code>readxl</code> package highlighted in Lab 1 and the <code>read_xlsx()</code> function to read in the data stored in the data folder of our R project:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>ngss_tweets <span class="ot">&lt;-</span> <span class="fu">read_xlsx</span>(<span class="st">"data/ngss_tweets.xlsx"</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>ccss_tweets <span class="ot">&lt;-</span> <span class="fu">read_xlsx</span>(<span class="st">"data/csss_tweets.xlsx"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="b.-tidy-text" class="level3">
<h3 class="anchored" data-anchor-id="b.-tidy-text">2b. Tidy Text</h3>
<p>Now that we have the data needed to answer our questions, we still have a little bit of work to do to get it ready for analysis. This section will revisit some familiar functions from Lab 1 and introduce a couple new functions:</p>
<section id="functions-used" class="level4">
<h4 class="anchored" data-anchor-id="functions-used">Functions Used</h4>
<p><strong><code>dplyr</code> functions</strong></p>
<ul>
<li><code>select()</code> picks variables based on their names.</li>
<li><code>slice()</code> lets you select, remove, and duplicate rows.</li>
<li><code>rename()</code> changes the names of individual variables using new_name = old_name syntax</li>
<li><code>filter()</code> picks cases, or rows, based on their values in a specified column.</li>
</ul>
<p><strong><code>tidytext</code> functions</strong></p>
<ul>
<li><code>unnest_tokens()</code> splits a column into tokens</li>
<li><code>anti_join()</code> returns all rows from x with<strong>out</strong> a match in y.</li>
</ul>
</section>
<section id="subset-rows-columns" class="level4">
<h4 class="anchored" data-anchor-id="subset-rows-columns">Subset Rows &amp; Columns</h4>
<p>As you are probably already aware, we have way more data than we’ll need for analysis and will need to pare it down quite a bit.</p>
<p>First, let’s use the <code>filter</code> function to subset rows containing only tweets in the language:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>ngss_text <span class="ot">&lt;-</span> <span class="fu">filter</span>(ngss_tweets, lang <span class="sc">==</span> <span class="st">"en"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now let’s select the following columns from our new <code>ngss_text</code> data frame:</p>
<ol type="1">
<li><code>screen_name</code> of the user who created the tweet</li>
<li><code>created_at</code> timestamp for examining changes in sentiment over time</li>
<li><code>text</code> containing the tweet which is our primary data source of interest</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>ngss_text <span class="ot">&lt;-</span> <span class="fu">select</span>(ngss_text,screen_name, created_at, text)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="add-reorder-columns" class="level4">
<h4 class="anchored" data-anchor-id="add-reorder-columns">Add &amp; Reorder Columns</h4>
<p>Since we are interested in comparing the sentiment of NGSS tweets with CSSS tweets, it would be helpful if we had a column for quickly identifying the set of state standards, with which each tweet is associated.</p>
<p>We’ll use the <code>mutate()</code> function to create a new variable called <code>standards</code> to label each tweets as “ngss”:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>ngss_text <span class="ot">&lt;-</span> <span class="fu">mutate</span>(ngss_text, <span class="at">standards =</span> <span class="st">"ngss"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And just because it bothers me, I’m going to use the <code>relocate()</code> function to move the <code>standards</code> column to the first position so I can quickly see which standards the tweet is from:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>ngss_text <span class="ot">&lt;-</span> <span class="fu">relocate</span>(ngss_text, standards)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note that you could also have used the <code>select()</code> function to reorder columns like so:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>ngss_text <span class="ot">&lt;-</span> <span class="fu">select</span>(ngss_text, standards, screen_name, created_at, text)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Finally, let’s rewrite the code above using the <code>%&gt;%</code> operator so there is less redundancy and it is easier to read:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>ngss_text <span class="ot">&lt;-</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  ngss_tweets <span class="sc">%&gt;%</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(lang <span class="sc">==</span> <span class="st">"en"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(screen_name, created_at, text) <span class="sc">%&gt;%</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">standards =</span> <span class="st">"ngss"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(standards)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="comprehension-check" class="level5">
<h5 class="anchored" data-anchor-id="comprehension-check">✅ Comprehension Check</h5>
<p><strong>WARNING:</strong> You will not be able to progress to the next section until you have completed the following task:</p>
<ol type="1">
<li>Create a new <code>ccss_text</code> data frame for our <code>ccss_tweets</code> Common Core tweets by modifying code above.</li>
</ol>
</section>
</section>
<section id="combine-data-frames" class="level4">
<h4 class="anchored" data-anchor-id="combine-data-frames">Combine Data Frames</h4>
<p>Finally, let’s combine our <code>ccss_text</code> and <code>ngss_text</code> into a single data frame by using the <code>bind_rows()</code> function from <code>dplyr</code> to simply supplying the data frames that you want to combine as arguments:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>tweets <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(ngss_text, ccss_text)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And let’s take a quick look at both the <code>head()</code> and the <code>tail()</code> of this new <code>tweets</code> data frame to make sure it contains both “ngss” and “ccss” standards:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(tweets)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 4
  standards screen_name  created_at          text                               
  &lt;chr&gt;     &lt;chr&gt;        &lt;dttm&gt;              &lt;chr&gt;                              
1 ngss      loyr2662     2021-02-27 17:33:27 "Switching gears for a bit for the…
2 ngss      loyr2662     2021-02-20 20:02:37 "Was just introduced to the Engine…
3 ngss      Furlow_teach 2021-02-27 17:03:23 "@IBchemmilam @chemmastercorey I’m…
4 ngss      Furlow_teach 2021-02-27 14:41:01 "@IBchemmilam @chemmastercorey How…
5 ngss      TdiShelton   2021-02-27 14:17:34 "I am so honored and appreciative …
6 ngss      TdiShelton   2021-02-27 15:49:17 "Thank you @brian_womack I loved c…</code></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tail</span>(tweets)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 4
  standards screen_name   created_at          text                              
  &lt;chr&gt;     &lt;chr&gt;         &lt;dttm&gt;              &lt;chr&gt;                             
1 ccss      JosiePaul8807 2021-02-20 00:34:53 "@SenatorHick You realize science…
2 ccss      ctwittnc      2021-02-19 23:44:18 "@winningatmylife I’ll bet none o…
3 ccss      the_rbeagle   2021-02-19 23:27:06 "@dmarush @electronlove @Montgome…
4 ccss      silea         2021-02-19 23:11:21 "@LizerReal I don’t think that’s …
5 ccss      JodyCoyote12  2021-02-19 22:58:25 "@CarlaRK3 @NedLamont Fully fund …
6 ccss      Ryan_Hawes    2021-02-19 22:41:01 "I just got an \"explainer\" on h…</code></pre>
</div>
</div>
</section>
<section id="tokenize-text" class="level4">
<h4 class="anchored" data-anchor-id="tokenize-text">Tokenize Text</h4>
<p>We have a couple remaining steps to tidy our text that hopefully should feel familiar by this point. If you recall from <a href="https://www.tidytextmining.com/tidytext.html">Chapter 1 of Text Mining With R</a>,&nbsp;Silge &amp; Robinson describe <strong>tokens</strong> as:</p>
<blockquote class="blockquote">
<p>A meaningful unit of text, such as a word, that we are interested in using for analysis, and tokenization is the process of splitting text into tokens. This one-token-per-row structure is in contrast to the ways text is often stored in current analyses, perhaps as strings or in a document-term matrix.</p>
</blockquote>
<p>First, let’s tokenize our tweets by using the <code>unnest_tokens()</code> function to split each tweet into a single row to make it easier to analyze:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>tweet_tokens <span class="ot">&lt;-</span> </span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  tweets <span class="sc">%&gt;%</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_tokens</span>(<span class="at">output =</span> word, </span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">input =</span> text)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notice that we’ve included an additional argument in the call to <code>unnest_tokens()</code>. Specifically, we used the specialized&nbsp;<code>“tweets”</code>&nbsp;tokenizer in the <code>tokens =</code> argument that is very useful for dealing with Twitter text or other text from online forums in that it retains hashtags and mentions of usernames with the @ symbol.</p>
</section>
<section id="remove-stop-words" class="level4">
<h4 class="anchored" data-anchor-id="remove-stop-words">Remove Stop Words</h4>
<p>Now let’s remove stop words like “the” and “a” that don’t help us learn much about what people are tweeting about the state standards.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>tidy_tweets <span class="ot">&lt;-</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  tweet_tokens <span class="sc">%&gt;%</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">anti_join</span>(stop_words, <span class="at">by =</span> <span class="st">"word"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notice that we’ve specified the <code>by =</code> argument to look for matching words in the <code>word</code> column for both data sets and remove any rows from the <code>tweet_tokens</code> dataset that match the <code>stop_words</code> dataset. Remember when we first tokenized our dataset I conveniently chose&nbsp;<code>output = word</code>&nbsp;as the column name because it matches the column name&nbsp;<code>word</code>&nbsp;in the&nbsp;<code>stop_words</code>&nbsp;dataset contained in the <code>tidytext</code> package. This makes our call to&nbsp;<code>anti_join()</code>simpler because&nbsp;<code>anti_join()</code>&nbsp;knows to look for the column named&nbsp;<code>word</code>&nbsp;in each dataset. However this wasn’t really necessary since <code>word</code> is the only matching column name in both datasets and it would have matched those columns by default.</p>
</section>
<section id="custom-stop-words" class="level4">
<h4 class="anchored" data-anchor-id="custom-stop-words">Custom Stop Words</h4>
<p>Before wrapping up, let’s take a quick count of the most common words in <code>tidy_tweets</code> data frame:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">count</span>(tidy_tweets, word, <span class="at">sort =</span> T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7,163 × 2
   word         n
   &lt;chr&gt;    &lt;int&gt;
 1 common    1112
 2 core      1109
 3 https      623
 4 t.co       623
 5 math       450
 6 ngss       224
 7 students   141
 8 science    140
 9 school     128
10 amp        127
# ℹ 7,153 more rows</code></pre>
</div>
</div>
<p>Notice that the nonsense word “amp” is in our top tens words. If we use the <code>filter()</code> function and `grep() query from Lab 1 on our <code>tweets</code> data frame, we can see that “amp” seems to be some sort of html residue that we might want to get rid of.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(tweets, <span class="fu">grepl</span>(<span class="st">'amp'</span>, text))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 124 × 4
   standards screen_name    created_at          text                            
   &lt;chr&gt;     &lt;chr&gt;          &lt;dttm&gt;              &lt;chr&gt;                           
 1 ngss      TdiShelton     2021-02-27 14:17:34 "I am so honored and appreciati…
 2 ngss      STEMTeachTools 2021-02-27 16:25:04 "Open, non-hierarchical communi…
 3 ngss      NGSSphenomena  2021-02-25 13:24:22 "Bacteria have music preference…
 4 ngss      CTSKeeley      2021-02-21 21:50:04 "Today I was thinking about the…
 5 ngss      richbacolor    2021-02-24 14:14:49 "Last chance to register for @M…
 6 ngss      MrsEatonELL    2021-02-27 06:24:09 "Were we doing the hand jive? N…
 7 ngss      STEMuClaytion  2021-02-24 14:56:19 "#WonderWednesday w/ questions …
 8 ngss      LearningUNDFTD 2021-02-24 18:13:01 "Are candies like M&amp;amp;Ms and …
 9 ngss      abeslo         2021-02-26 18:54:31 "#M'Kenna, whose story we share…
10 ngss      E3Chemistry    2021-02-25 14:15:20 "Molarity &amp;amp; Parts Per Milli…
# ℹ 114 more rows</code></pre>
</div>
</div>
<p>Let’s rewrite our stop word code to add a custom stop word to filter out rows with “amp” in them:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>tidy_tweets <span class="ot">&lt;-</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  tweet_tokens <span class="sc">%&gt;%</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">anti_join</span>(stop_words, <span class="at">by =</span> <span class="st">"word"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>word <span class="sc">==</span> <span class="st">"amp"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note that we could extend this filter to weed out any additional words that don’t carry much meaning but skew our data by being so prominent.</p>
<section id="comprehension-check-1" class="level5">
<h5 class="anchored" data-anchor-id="comprehension-check-1">✅ Comprehension Check</h5>
<p>We’ve created some unnecessarily lengthy code to demonstrate some of the steps in the tidying process. Rewrite the tokenization and removal of stop words processes into a more compact series of commands and save your data frame as <code>tidy_tweets</code>.</p>
</section>
</section>
</section>
<section id="c.-add-sentiment-values" class="level3">
<h3 class="anchored" data-anchor-id="c.-add-sentiment-values">2c. Add Sentiment Values</h3>
<p>Now that we have our tweets nice and tidy, we’re almost ready to begin exploring public sentiment around the CCSS and NGSS standards. For this part of our workflow we introduce two new functions from the <a href="https://github.com/juliasilge/tidytext"><code>tidytext</code></a> and <code>dplyr</code> packages respectively:</p>
<ul>
<li><code>get_sentiments()</code> returns specific sentiment lexicons with the associated measures for each word in the lexicon</li>
<li><code>inner_join()</code> return all rows from&nbsp;<code>x</code>&nbsp;where there are matching values in&nbsp;<code>y</code>, and all columns from&nbsp;<code>x</code>&nbsp;and&nbsp;<code>y</code>.</li>
</ul>
<p>For a quick overview of the different join functions with helpful visuals, visit: <a href="https://statisticsglobe.com/r-dplyr-join-inner-left-right-full-semi-anti" class="uri">https://statisticsglobe.com/r-dplyr-join-inner-left-right-full-semi-anti</a></p>
<section id="get-sentiments" class="level4">
<h4 class="anchored" data-anchor-id="get-sentiments">Get Sentiments</h4>
<p>Recall from our readings that sentiment analysis tries to evaluate words for their emotional association. Silge &amp; Robinson point out that, “one way to analyze the sentiment of a text is to consider the text as a combination of its individual words and the sentiment content of the whole text as the sum of the sentiment content of the individual words.” As our readings illustrated, this isn’t the only way to approach sentiment analysis, but it is an easier entry point into sentiment analysis and often-used.</p>
<p>The tidytext package provides access to several sentiment lexicons based on unigrams, i.e., single words. These lexicons contain many English words and the words are assigned scores for positive/negative sentiment, and also possibly emotions like joy, anger, sadness, and so forth.</p>
<p>The three general-purpose lexicons we’ll focus on are:</p>
<ul>
<li><p><code>AFINN</code> assigns words with a score that runs between -5 and 5, with negative scores indicating negative sentiment and positive scores indicating positive sentiment.</p></li>
<li><p><code>bing</code> categorizes words in a binary fashion into positive and negative categories.</p></li>
<li><p><code>nrc</code>&nbsp;categorizes words in a binary fashion (“yes”/“no”) into categories of positive, negative, anger, anticipation, disgust, fear, joy, sadness, surprise, and trust.</p></li>
</ul>
<p>Note that if this is your first time using the AFINN and NRC lexicons, you’ll be prompted to download both Respond yes to the prompt by entering “1” and the NRC and AFINN lexicons will download. You’ll only have to do this the first time you use the NRC lexicon.</p>
<p>Let’s take a quick look at each of these lexicons using the <code>get_sentiments()</code> function and assign them to their respective names for later use:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>afinn <span class="ot">&lt;-</span> <span class="fu">get_sentiments</span>(<span class="st">"afinn"</span>)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>afinn</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2,477 × 2
   word       value
   &lt;chr&gt;      &lt;dbl&gt;
 1 abandon       -2
 2 abandoned     -2
 3 abandons      -2
 4 abducted      -2
 5 abduction     -2
 6 abductions    -2
 7 abhor         -3
 8 abhorred      -3
 9 abhorrent     -3
10 abhors        -3
# ℹ 2,467 more rows</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>bing <span class="ot">&lt;-</span> <span class="fu">get_sentiments</span>(<span class="st">"bing"</span>)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>bing</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6,786 × 2
   word        sentiment
   &lt;chr&gt;       &lt;chr&gt;    
 1 2-faces     negative 
 2 abnormal    negative 
 3 abolish     negative 
 4 abominable  negative 
 5 abominably  negative 
 6 abominate   negative 
 7 abomination negative 
 8 abort       negative 
 9 aborted     negative 
10 aborts      negative 
# ℹ 6,776 more rows</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>nrc <span class="ot">&lt;-</span> <span class="fu">get_sentiments</span>(<span class="st">"nrc"</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>nrc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 13,872 × 2
   word        sentiment
   &lt;chr&gt;       &lt;chr&gt;    
 1 abacus      trust    
 2 abandon     fear     
 3 abandon     negative 
 4 abandon     sadness  
 5 abandoned   anger    
 6 abandoned   fear     
 7 abandoned   negative 
 8 abandoned   sadness  
 9 abandonment anger    
10 abandonment fear     
# ℹ 13,862 more rows</code></pre>
</div>
</div>
<p>And just out of curiosity, let’s take a look at the <code>loughran</code> lexicon as well:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>loughran <span class="ot">&lt;-</span> <span class="fu">get_sentiments</span>(<span class="st">"loughran"</span>)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>loughran</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4,150 × 2
   word         sentiment
   &lt;chr&gt;        &lt;chr&gt;    
 1 abandon      negative 
 2 abandoned    negative 
 3 abandoning   negative 
 4 abandonment  negative 
 5 abandonments negative 
 6 abandons     negative 
 7 abdicated    negative 
 8 abdicates    negative 
 9 abdicating   negative 
10 abdication   negative 
# ℹ 4,140 more rows</code></pre>
</div>
</div>
<section id="comprehension-check-2" class="level5">
<h5 class="anchored" data-anchor-id="comprehension-check-2">✅ Comprehension Check</h5>
<ol type="1">
<li>How were these sentiment lexicons put together and validated? Hint: take a look at Chapter 2 from Text Mining with R.</li>
<li>Why should we be cautious when using and interpreting them?</li>
</ol>
</section>
</section>
<section id="join-sentiments" class="level4">
<h4 class="anchored" data-anchor-id="join-sentiments">Join Sentiments</h4>
<p>We’ve reached the final step in our data wrangling process before we can begin exploring our data to address our questions.</p>
<p>In the previous section, we used&nbsp;<code>anti_join()</code>&nbsp;to remove stop words in our dataset. For sentiment analysis, we’re going use the <code>inner_join()</code> function to do something similar. However, instead of removing rows that contain words matching those in our stop words dictionary, <code>inner_join()</code> allows us to keep only the rows with words that match words in our sentiment lexicons, or dictionaries, along with the sentiment measure for that word from the sentiment lexicon.</p>
<p>Let’s use <code>inner_join()</code> to combine our two <code>tidy_tweets</code> and <code>afinn</code> data frames, keeping only rows with matching data in the <code>word</code> column:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>sentiment_afinn <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(tidy_tweets, afinn, <span class="at">by =</span> <span class="st">"word"</span>)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>sentiment_afinn</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1,540 × 5
   standards screen_name  created_at          word         value
   &lt;chr&gt;     &lt;chr&gt;        &lt;dttm&gt;              &lt;chr&gt;        &lt;dbl&gt;
 1 ngss      loyr2662     2021-02-27 17:33:27 win              4
 2 ngss      Furlow_teach 2021-02-27 17:03:23 love             3
 3 ngss      Furlow_teach 2021-02-27 17:03:23 sweet            2
 4 ngss      Furlow_teach 2021-02-27 17:03:23 significance     1
 5 ngss      TdiShelton   2021-02-27 14:17:34 honored          2
 6 ngss      TdiShelton   2021-02-27 14:17:34 opportunity      2
 7 ngss      TdiShelton   2021-02-27 14:17:34 wonderful        4
 8 ngss      TdiShelton   2021-02-27 14:17:34 powerful         2
 9 ngss      TdiShelton   2021-02-27 15:49:17 loved            3
10 ngss      TdiShelton   2021-02-27 16:51:32 share            1
# ℹ 1,530 more rows</code></pre>
</div>
</div>
<p>Notice that each word in your <code>sentiment_afinn</code> data frame now contains a value ranging from -5 (very negative) to 5 (very positive).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>sentiment_bing <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(tidy_tweets, bing, <span class="at">by =</span> <span class="st">"word"</span>)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>sentiment_bing</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1,668 × 5
   standards screen_name  created_at          word         sentiment
   &lt;chr&gt;     &lt;chr&gt;        &lt;dttm&gt;              &lt;chr&gt;        &lt;chr&gt;    
 1 ngss      loyr2662     2021-02-27 17:33:27 win          positive 
 2 ngss      Furlow_teach 2021-02-27 17:03:23 love         positive 
 3 ngss      Furlow_teach 2021-02-27 17:03:23 helped       positive 
 4 ngss      Furlow_teach 2021-02-27 17:03:23 sweet        positive 
 5 ngss      Furlow_teach 2021-02-27 17:03:23 tough        positive 
 6 ngss      TdiShelton   2021-02-27 14:17:34 honored      positive 
 7 ngss      TdiShelton   2021-02-27 14:17:34 appreciative positive 
 8 ngss      TdiShelton   2021-02-27 14:17:34 wonderful    positive 
 9 ngss      TdiShelton   2021-02-27 14:17:34 powerful     positive 
10 ngss      TdiShelton   2021-02-27 15:49:17 loved        positive 
# ℹ 1,658 more rows</code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>Warning in inner_join(tidy_tweets, nrc, by = "word"): Detected an unexpected many-to-many relationship between `x` and `y`.
ℹ Row 26 of `x` matches multiple rows in `y`.
ℹ Row 7509 of `y` matches multiple rows in `x`.
ℹ If a many-to-many relationship is expected, set `relationship =
  "many-to-many"` to silence this warning.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in inner_join(tidy_tweets, loughran, by = "word"): Detected an unexpected many-to-many relationship between `x` and `y`.
ℹ Row 2417 of `x` matches multiple rows in `y`.
ℹ Row 2589 of `y` matches multiple rows in `x`.
ℹ If a many-to-many relationship is expected, set `relationship =
  "many-to-many"` to silence this warning.</code></pre>
</div>
</div>
<section id="comprehension-check-3" class="level5">
<h5 class="anchored" data-anchor-id="comprehension-check-3">✅ Comprehension Check</h5>
<ol type="1">
<li>Create a <code>sentiment_nrc</code> data frame using the code above.</li>
<li>What do you notice about the change in the number of observations (i.e.&nbsp;words) between the <code>tidy_tweets</code> and data frames with sentiment values attached? Why did this happen?</li>
</ol>
<p><strong>Note:</strong> To complete to the following section, you’ll need the <code>sentiment_nrc</code> data frame.</p>
</section>
</section>
</section>
</section>
<section id="explore" class="level2">
<h2 class="anchored" data-anchor-id="explore">3. EXPLORE</h2>
<p>Now that we have our tweets tidied and sentiments joined, we’re ready for a little data exploration. As highlighted in Lab 1, calculating summary statistics, data visualization, and feature engineering (the process of creating new variables from a dataset) are a key part of exploratory data analysis. One goal in this phase is explore questions that drove the original analysis and develop new questions and hypotheses to test in later stages. Topics addressed in Section 3 include:</p>
<ol type="a">
<li><strong>Time Series</strong>. We take a quick look at the date range of our tweets and compare number of postings by standards.</li>
<li><strong>Sentiment Summaries</strong>. We put together some basic summaries of our sentiment values in order to compare public sentiment</li>
</ol>
<section id="a.-time-series" class="level3">
<h3 class="anchored" data-anchor-id="a.-time-series">3a. Time Series</h3>
<p>Before we dig into sentiment, let’s use the handy <code>ts_plot</code> function built into <code>rtweet</code> to take a very quick look at how far back our tidied <code>tweets</code> data set goes:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co">#ts_plot(tweets, by = "days")</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Aggregate tweets by date</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>tweet_counts <span class="ot">&lt;-</span> tweets <span class="sc">%&gt;%</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">as.Date</span>(created_at)) <span class="sc">%&gt;%</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">count</span>(date)</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot using ggplot2</span></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(tweet_counts, <span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> n)) <span class="sc">+</span></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>   <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Tweets over time"</span>,</span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> <span class="st">"Date"</span>,</span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Number of tweets"</span>) <span class="sc">+</span></span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="lab-2-case-study_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Notice that this effectively creates a <code>ggplot</code> time series plot for us. I’ve included the <code>by =</code> argument which by default is set to “days”. Try changing it to “hours” and see what happens.</p>
<section id="comprehension-check-4" class="level5">
<h5 class="anchored" data-anchor-id="comprehension-check-4">✅ Comprehension Check</h5>
<ol type="1">
<li>Use <code>ts_plot</code> with the <code>group_by</code> function to compare the number of tweets over time by Next Gen and Common Core <code>standards</code></li>
<li>Which set of standards is Twitter users talking about the most?</li>
</ol>
<p>Hint: use the <code>?ts_plot</code> help function to check the examples to see how this can be done.</p>
<p>Your line graph should look something like this:</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="lab-2-case-study_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="b.-sentiment-summaries" class="level3">
<h3 class="anchored" data-anchor-id="b.-sentiment-summaries">3b. Sentiment Summaries</h3>
<p>Since our primary goals is to compare public sentiment around the NGSS and CCSS state standards, in this section we put together some basic numerical summaries using our different lexicons to see whether tweets are generally more positive or negative for each standard as well as differences between the two. To do this, we revisit the following <code>dplyr</code> functions:</p>
<ul>
<li><p><a href="https://dplyr.tidyverse.org/reference/count.html?q=count"><code>count()</code></a> lets you quickly count the unique values of one or more variables</p></li>
<li><p><a href="https://dplyr.tidyverse.org/articles/grouping.html?q=group"><code>group_by()</code></a> takes a data frame and one or more variables to group by</p></li>
<li><p><a href="https://dplyr.tidyverse.org/reference/summarise.html"><code>summarise()</code></a> creates a numerical summary of data using arguments like <a href="https://rdrr.io/r/base/mean.html"><code>mean()</code></a> and&nbsp;<a href="https://rdrr.io/r/stats/median.html"><code>median()</code></a></p></li>
<li><p><a href="https://dplyr.tidyverse.org/reference/mutate.html"><code>mutate()</code></a> adds new variables and preserves existing ones</p></li>
</ul>
<p>And introduce one new function:</p>
<ul>
<li><code>spread()</code></li>
</ul>
<section id="sentiment-counts" class="level4">
<h4 class="anchored" data-anchor-id="sentiment-counts">Sentiment Counts</h4>
<p>Let’s start with <code>bing</code>, our simplest sentiment lexicon, and use the <code>count</code> function to count how many times in our <code>sentiment_bing</code> data frame “positive” and “negative” occur in <code>sentiment</code> column and :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>summary_bing <span class="ot">&lt;-</span> <span class="fu">count</span>(sentiment_bing, sentiment, <span class="at">sort =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Collectively, it looks like our combined dataset has more positive words than negative words.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>summary_bing</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 2
  sentiment     n
  &lt;chr&gt;     &lt;int&gt;
1 negative    992
2 positive    676</code></pre>
</div>
</div>
<p>Since our main goal is to compare positive and negative sentiment between CCSS and NGSS, let’s use the <code>group_by</code> function again to get <code>sentiment</code> summaries for NGSS and CCSS separately:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>summary_bing <span class="ot">&lt;-</span> sentiment_bing <span class="sc">%&gt;%</span> </span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(standards) <span class="sc">%&gt;%</span> </span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(sentiment) </span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>summary_bing</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 3
# Groups:   standards [2]
  standards sentiment     n
  &lt;chr&gt;     &lt;chr&gt;     &lt;int&gt;
1 ccss      negative    926
2 ccss      positive    446
3 ngss      negative     66
4 ngss      positive    230</code></pre>
</div>
</div>
<p>Looks like CCSS have far more negative words than positive, while NGSS skews much more positive. So far, pretty consistent with Rosenberg et al.&nbsp;findings!!!</p>
</section>
<section id="compute-sentiment-value" class="level4">
<h4 class="anchored" data-anchor-id="compute-sentiment-value">Compute Sentiment Value</h4>
<p>Our last step will be calculate a single sentiment “score” for our tweets that we can use for quick comparison and create a new variable indicating which lexicon we used.</p>
<p>First, let’s untidy our data a little by using the <code>spread</code> function from the <code>tidyr</code> package to transform our <code>sentiment</code> column into separate columns for <code>negative</code> and <code>positive</code> that contains the <code>n</code> counts for each:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>summary_bing <span class="ot">&lt;-</span> sentiment_bing <span class="sc">%&gt;%</span> </span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(standards) <span class="sc">%&gt;%</span> </span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(sentiment, <span class="at">sort =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">spread</span>(sentiment, n) </span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>summary_bing</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 3
# Groups:   standards [2]
  standards negative positive
  &lt;chr&gt;        &lt;int&gt;    &lt;int&gt;
1 ccss           926      446
2 ngss            66      230</code></pre>
</div>
</div>
<p>Finally, we’ll use the <code>mutate</code> function to create two new variables: <code>sentiment</code> and <code>lexicon</code> so we have a single sentiment score and the lexicon from which it was derived:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>summary_bing <span class="ot">&lt;-</span> sentiment_bing <span class="sc">%&gt;%</span> </span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(standards) <span class="sc">%&gt;%</span> </span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(sentiment, <span class="at">sort =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">spread</span>(sentiment, n) <span class="sc">%&gt;%</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sentiment =</span> positive <span class="sc">-</span> negative) <span class="sc">%&gt;%</span></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lexicon =</span> <span class="st">"bing"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(lexicon)</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>summary_bing</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 5
# Groups:   standards [2]
  lexicon standards negative positive sentiment
  &lt;chr&gt;   &lt;chr&gt;        &lt;int&gt;    &lt;int&gt;     &lt;int&gt;
1 bing    ccss           926      446      -480
2 bing    ngss            66      230       164</code></pre>
</div>
</div>
<p>There we go, now we can see that CCSS scores negative, while NGSS is overall positive.</p>
<p>Let’s calculate a quick score for using the <code>afinn</code> lexicon now. Remember that AFINN provides a value from -5 to 5 for each:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(sentiment_afinn)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 5
  standards screen_name  created_at          word         value
  &lt;chr&gt;     &lt;chr&gt;        &lt;dttm&gt;              &lt;chr&gt;        &lt;dbl&gt;
1 ngss      loyr2662     2021-02-27 17:33:27 win              4
2 ngss      Furlow_teach 2021-02-27 17:03:23 love             3
3 ngss      Furlow_teach 2021-02-27 17:03:23 sweet            2
4 ngss      Furlow_teach 2021-02-27 17:03:23 significance     1
5 ngss      TdiShelton   2021-02-27 14:17:34 honored          2
6 ngss      TdiShelton   2021-02-27 14:17:34 opportunity      2</code></pre>
</div>
</div>
<p>To calculate late a summary score, we will need to first group our data by <code>standards</code> again and then use the <code>summarise</code> function to create a new <code>sentiment</code> variable by adding all the positive and negative scores in the <code>value</code> column:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>summary_afinn <span class="ot">&lt;-</span> sentiment_afinn <span class="sc">%&gt;%</span> </span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(standards) <span class="sc">%&gt;%</span> </span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">sentiment =</span> <span class="fu">sum</span>(value)) <span class="sc">%&gt;%</span> </span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lexicon =</span> <span class="st">"AFINN"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(lexicon)</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>summary_afinn</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 3
  lexicon standards sentiment
  &lt;chr&gt;   &lt;chr&gt;         &lt;dbl&gt;
1 AFINN   ccss           -808
2 AFINN   ngss            503</code></pre>
</div>
</div>
<p>Again, CCSS is overall negative while NGSS is overall positive!</p>
<section id="comprehension-check-5" class="level5">
<h5 class="anchored" data-anchor-id="comprehension-check-5">✅ Comprehension Check</h5>
<p>For your final task for this walkthough, calculate a single sentiment score for NGSS and CCSS using the remaining <code>nrc</code> and <code>loughan</code> lexicons and answer the following questions. Are these findings above still consistent?</p>
<p>Hint: The <code>nrc</code> lexicon contains “positive” and “negative” values just like <code>bing</code> and <code>loughan</code>, but also includes values like “trust” and “sadness” as shown below. You will need to use the <code>filter()</code> function to select rows that only contain “positive” and “negative.”</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>nrc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 13,872 × 2
   word        sentiment
   &lt;chr&gt;       &lt;chr&gt;    
 1 abacus      trust    
 2 abandon     fear     
 3 abandon     negative 
 4 abandon     sadness  
 5 abandoned   anger    
 6 abandoned   fear     
 7 abandoned   negative 
 8 abandoned   sadness  
 9 abandonment anger    
10 abandonment fear     
# ℹ 13,862 more rows</code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 5
# Groups:   standards [2]
  standards method negative positive sentiment
  &lt;chr&gt;     &lt;chr&gt;     &lt;int&gt;    &lt;int&gt;     &lt;dbl&gt;
1 ccss      nrc         766     2294      2.99
2 ngss      nrc          79      571      7.23</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 3
  lexicon standards sentiment
  &lt;chr&gt;   &lt;chr&gt;         &lt;dbl&gt;
1 AFINN   ccss           -808
2 AFINN   ngss            503</code></pre>
</div>
</div>
</section>
</section>
</section>
</section>
<section id="model" class="level2">
<h2 class="anchored" data-anchor-id="model">4. MODEL</h2>
<p>As highlighted in <a href="https://datascienceineducation.com/c03.html">Chapter 3 of Data Science in Education Using R</a>, the <strong>Model</strong> step of the data science process entails “using statistical models, from simple to complex, to understand trends and patterns in the data.” The authors note that while descriptive statistics and data visualization during the <strong>Explore</strong> step can help us to identify patterns and relationships in our data, statistical models can be used to help us determine if relationships, patterns and trends are actually meaningful.</p>
<p>Recall from the PREPARE section, that the Rosenberg et al.&nbsp;study was guided by the following questions:</p>
<ol type="1">
<li>What is the public sentiment expressed toward the NGSS?</li>
<li>How does sentiment for teachers differ from non-teachers?</li>
<li>How do tweets posted to #NGSSchat differ from those without the hashtag?</li>
<li>How does participation in #NGSSchat relate to the public sentiment individuals express?</li>
<li>How does public sentiment vary over time?</li>
</ol>
<p>Similar to our sentiment summary using the AFINN lexicon, the Rosenberg et al.&nbsp;study used the -5 to 5 sentiment score from the SentiStrength lexicon to answer RQ #1. To address the remaining questions the authors used a mixed effects model (also known as multi-level or hierarchical linear models via the lme4 package in R.</p>
<p>Collectively, the authors found that:</p>
<ol type="1">
<li>The SentiStrength scale indicated an overall neutral sentiment for tweets about the Next Generation Science Standards.</li>
<li>Teachers were more positive in their posts than other participants.</li>
<li>Posts including #NGSSchat that were posted outside of chats were slightly more positive relative to those that did not include the #NGSSchat hashtag.</li>
<li>The effect upon individuals of being involved in the #NGSSchat was positive, suggesting that there is an impact on individuals—not tweets—of participating in a community focused on the NGSS.</li>
<li>Posts about the NGSS became substantially more positive over time.</li>
</ol>
</section>
<section id="communicate" class="level2">
<h2 class="anchored" data-anchor-id="communicate">5. COMMUNICATE</h2>
<p>The final(ish) step in our workflow/process is sharing the results of analysis with wider audience. Krumm et al.&nbsp;(2018) outlined the following 3-step process for communicating with education stakeholders what you have learned through analysis:</p>
<ol type="1">
<li><strong>Select</strong>. Communicating what one has learned involves selecting among those analyses that are most important and most useful to an intended audience, as well as selecting a form for displaying that information, such as a graph or table in static or interactive form, i.e.&nbsp;a “data product.”</li>
<li><strong>Polish</strong>. After creating initial versions of data products, research teams often spend time refining or polishing them, by adding or editing titles, labels, and notations and by working with colors and shapes to highlight key points.</li>
<li><strong>Narrate</strong>. Writing a narrative to accompany the data products involves, at a minimum, pairing a data product with its related research question, describing how best to interpret the data product, and explaining the ways in which the data product helps answer the research question.</li>
</ol>
<section id="a.-select" class="level3">
<h3 class="anchored" data-anchor-id="a.-select">5a. Select</h3>
<p>Remember that the questions of interest that we want to focus on for our selection, polishing, and narration include:</p>
<ol type="1">
<li>What is the public sentiment expressed toward the NGSS?</li>
<li>How does sentiment for NGSS compare to sentiment for CCSS?</li>
</ol>
<p>To address questions 1 and 2, I’m going to focus my analyses, data products and sharing format on the following:</p>
<ol type="1">
<li><strong>Analyses</strong>. For RQ1, I want to try and replicate as closely as possible the analysis by Rosenberg et al., so I will clean up my analysis and calculate a single sentiment score using the AFINN Lexicon for the entire tweet and label it positive or negative based on that score. I also want to highlight how regardless of the lexicon selected, NGSS tweets contain more positive words than negative, so I’ll also polish my previous analyses and calculate percentages of positive and negative words for the tweets.</li>
<li><strong>Data Products</strong>. I know these are shunned in the world of data viz, but I think a <strong>pie chart</strong> will actually be an effective way to quickly communicate the proportion of positive and negative tweets among the Next Generation Science Standards. And for my analyses with the <code>bing</code>, <code>nrc</code>, and <code>loughan</code> lexicons, I’ll create some 100% stacked bars showing the percentage of positive and negative words among all tweets for the NGSS and CCSS.</li>
<li><strong>Format</strong>. Similar to Lab 1, I’ll be using <a href="https://rmarkdown.rstudio.com">R Markdown</a> again to create a quick slide deck. Recall that R Markdown files can also be used to create a <a href="https://rmarkdown.rstudio.com/gallery.html">wide range of outputs and formats</a>, including polished PDF or Word documents, websites, web apps, journal articles, online books, interactive tutorials and more. And to make this process even more user-friendly, R Studio now includes <a href="https://rstudio.github.io/visual-markdown-editing/#/">a visual editor</a>!</li>
</ol>
</section>
<section id="b.-polish" class="level3">
<h3 class="anchored" data-anchor-id="b.-polish">5b. Polish</h3>
<section id="ngss-sentiment" class="level4">
<h4 class="anchored" data-anchor-id="ngss-sentiment">NGSS Sentiment</h4>
<p>I want to replicate as closely as possible the approach that Rosenberg et al.&nbsp;used in their analysis. To do that, I’ll recycle some R code I used in section <a href="#b.-tidy-text">2b. Tidy Text</a>.</p>
<p>To polish my analyses and prepare, first I need to rebuild the <code>tweets</code> dataset from my <code>ngss_tweets</code> and <code>ccss_tweets</code> and select both the <code>status_id</code> that is unique to each tweet, and the <code>text</code> column which contains the actual post:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>ngss_text <span class="ot">&lt;-</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>  ngss_tweets <span class="sc">%&gt;%</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(lang <span class="sc">==</span> <span class="st">"en"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(status_id, text) <span class="sc">%&gt;%</span></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">standards =</span> <span class="st">"ngss"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(standards)</span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>ccss_text <span class="ot">&lt;-</span></span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>  ccss_tweets <span class="sc">%&gt;%</span></span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(lang <span class="sc">==</span> <span class="st">"en"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(status_id, text) <span class="sc">%&gt;%</span></span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">standards =</span> <span class="st">"ccss"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(standards)</span>
<span id="cb53-14"><a href="#cb53-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-15"><a href="#cb53-15" aria-hidden="true" tabindex="-1"></a>tweets <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(ngss_text, ccss_text)</span>
<span id="cb53-16"><a href="#cb53-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-17"><a href="#cb53-17" aria-hidden="true" tabindex="-1"></a>tweets</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1,441 × 3
   standards status_id           text                                           
   &lt;chr&gt;     &lt;chr&gt;               &lt;chr&gt;                                          
 1 ngss      1365716690336645124 "Switching gears for a bit for the \"Crosscutt…
 2 ngss      1363217513761415171 "Was just introduced to the Engineering Habits…
 3 ngss      1365709122763653133 "@IBchemmilam @chemmastercorey I’m familiar w/…
 4 ngss      1365673294360420353 "@IBchemmilam @chemmastercorey How well does t…
 5 ngss      1365667393188601857 "I am so honored and appreciative to have an o…
 6 ngss      1365690477266284545 "Thank you @brian_womack I loved connecting wi…
 7 ngss      1365706140496130050 "Please share #NGSSchat PLN! https://t.co/Qc2c…
 8 ngss      1363669328147677189 "So excited about this weekend’s learning... p…
 9 ngss      1365442786544214019 "The Educators Evaluating the Quality of Instr…
10 ngss      1364358149164175362 "Foster existing teacher social networks that …
# ℹ 1,431 more rows</code></pre>
</div>
</div>
<p>The <code>status_id</code> is important because like Rosenberg et al., I want to calculate an overall sentiment score for each tweet, rather than for each word.</p>
<p>Before I get that far however, I’ll need to tidy my <code>tweets</code> again and attach my <code>sentiment</code> scores.</p>
<p>Note that the closest lexicon we have available in our <code>tidytext</code> package to the SentiStrength lexicon used by Rosenberg is the AFINN lexicon which also uses a -5 to 5 point scale.</p>
<p>So let’s use <code>unnest_tokens</code> to tidy our tweets, remove stop words, and add <code>afinn</code> scores to each word similar to what we did in section <a href="#c.-add-sentiment-values">2c. Add Sentiment Values</a>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>sentiment_afinn <span class="ot">&lt;-</span> tweets <span class="sc">%&gt;%</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_tokens</span>(<span class="at">output =</span> word, </span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">input =</span> text)  <span class="sc">%&gt;%</span> </span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">anti_join</span>(stop_words, <span class="at">by =</span> <span class="st">"word"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>word <span class="sc">==</span> <span class="st">"amp"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(afinn, <span class="at">by =</span> <span class="st">"word"</span>)</span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>sentiment_afinn</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1,540 × 4
   standards status_id           word         value
   &lt;chr&gt;     &lt;chr&gt;               &lt;chr&gt;        &lt;dbl&gt;
 1 ngss      1365716690336645124 win              4
 2 ngss      1365709122763653133 love             3
 3 ngss      1365709122763653133 sweet            2
 4 ngss      1365709122763653133 significance     1
 5 ngss      1365667393188601857 honored          2
 6 ngss      1365667393188601857 opportunity      2
 7 ngss      1365667393188601857 wonderful        4
 8 ngss      1365667393188601857 powerful         2
 9 ngss      1365690477266284545 loved            3
10 ngss      1365706140496130050 share            1
# ℹ 1,530 more rows</code></pre>
</div>
</div>
<p>Next, I want to calculate a single score for each tweet. To do that, I’ll use the by now familiar <code>group_by</code> and <code>summarize</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>afinn_score <span class="ot">&lt;-</span> sentiment_afinn <span class="sc">%&gt;%</span> </span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(standards, status_id) <span class="sc">%&gt;%</span> </span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">value =</span> <span class="fu">sum</span>(value))</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>afinn_score</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 857 × 3
# Groups:   standards [2]
   standards status_id           value
   &lt;chr&gt;     &lt;chr&gt;               &lt;dbl&gt;
 1 ccss      1362894990813188096     2
 2 ccss      1362899370199445508     4
 3 ccss      1362906588021989376    -2
 4 ccss      1362910494487535618    -9
 5 ccss      1362910913855160320    -1
 6 ccss      1362928225379250179     2
 7 ccss      1362933982074073090    -1
 8 ccss      1362947497258151945    -3
 9 ccss      1362949805694013446     3
10 ccss      1362970614282264583     3
# ℹ 847 more rows</code></pre>
</div>
</div>
<p>And like Rosenberg et al., I’ll add a flag for whether the tweet is “positive” or “negative” using the <code>mutate</code> function to create a new <code>sentiment</code> column to indicate whether that tweets was positive or negative.</p>
<p>To do this, we introduced the new <code>if_else</code> function from the <code>dplyr</code> package. This <code>if_else</code> function adds “negative” to the <code>sentiment</code> column if the score in the <code>value</code> column of the corresponding row is less than 0. If not, it will add a “positive” to the row.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>afinn_sentiment <span class="ot">&lt;-</span> afinn_score <span class="sc">%&gt;%</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(value <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sentiment =</span> <span class="fu">if_else</span>(value <span class="sc">&lt;</span> <span class="dv">0</span>, <span class="st">"negative"</span>, <span class="st">"positive"</span>))</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>afinn_sentiment</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 820 × 4
# Groups:   standards [2]
   standards status_id           value sentiment
   &lt;chr&gt;     &lt;chr&gt;               &lt;dbl&gt; &lt;chr&gt;    
 1 ccss      1362894990813188096     2 positive 
 2 ccss      1362899370199445508     4 positive 
 3 ccss      1362906588021989376    -2 negative 
 4 ccss      1362910494487535618    -9 negative 
 5 ccss      1362910913855160320    -1 negative 
 6 ccss      1362928225379250179     2 positive 
 7 ccss      1362933982074073090    -1 negative 
 8 ccss      1362947497258151945    -3 negative 
 9 ccss      1362949805694013446     3 positive 
10 ccss      1362970614282264583     3 positive 
# ℹ 810 more rows</code></pre>
</div>
</div>
<p>Note that since a tweet sentiment score equal to 0 is neutral, I used the <code>filter</code> function to remove it from the dataset.</p>
<p>Finally, we’re ready to compute our ratio. We’ll use the <code>group_by</code> function and <code>count</code> the number of tweets for each of the <code>standards</code> that are positive or negative in the <code>sentiment</code> column. Then we’ll use the <code>spread</code> function to separate them out into separate columns so we can perform a quick calculation to compute the <code>ratio</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>afinn_ratio <span class="ot">&lt;-</span> afinn_sentiment <span class="sc">%&gt;%</span> </span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(standards) <span class="sc">%&gt;%</span> </span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(sentiment) <span class="sc">%&gt;%</span> </span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">spread</span>(sentiment, n) <span class="sc">%&gt;%</span></span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ratio =</span> negative<span class="sc">/</span>positive)</span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>afinn_ratio</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 4
# Groups:   standards [2]
  standards negative positive ratio
  &lt;chr&gt;        &lt;int&gt;    &lt;int&gt; &lt;dbl&gt;
1 ccss           421      211 2.00 
2 ngss            21      167 0.126</code></pre>
</div>
</div>
<p>Finally,</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>afinn_counts <span class="ot">&lt;-</span> afinn_sentiment <span class="sc">%&gt;%</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(standards) <span class="sc">%&gt;%</span> </span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(sentiment) <span class="sc">%&gt;%</span></span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(standards <span class="sc">==</span> <span class="st">"ngss"</span>)</span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>afinn_counts <span class="sc">%&gt;%</span></span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span><span class="st">""</span>, <span class="at">y=</span>n, <span class="at">fill=</span>sentiment)) <span class="sc">+</span></span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">width =</span> .<span class="dv">6</span>, <span class="at">stat =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Next Gen Science Standards"</span>,</span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Proportion of Positive &amp; Negative Tweets"</span>) <span class="sc">+</span></span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_polar</span>(<span class="at">theta =</span> <span class="st">"y"</span>) <span class="sc">+</span></span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="lab-2-case-study_files/figure-html/unnamed-chunk-40-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="ngss-vs-ccss" class="level4">
<h4 class="anchored" data-anchor-id="ngss-vs-ccss">NGSS vs CCSS</h4>
<p>Finally, to address Question 2, I want to compare the percentage of positive and negative words contained in the corpus of tweets for the NGSS and CCSS standards using the four different lexicons to see how sentiment compares based on lexicon used.</p>
<p>I’ll begin by polishing my previous summaries and creating identical summaries for each lexicon that contains the following columns: <code>method</code>, <code>standards</code>, <code>sentiment</code>, and <code>n</code>, or word counts:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>summary_afinn2 <span class="ot">&lt;-</span> sentiment_afinn <span class="sc">%&gt;%</span> </span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(standards) <span class="sc">%&gt;%</span> </span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(value <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sentiment =</span> <span class="fu">if_else</span>(value <span class="sc">&lt;</span> <span class="dv">0</span>, <span class="st">"negative"</span>, <span class="st">"positive"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(sentiment, <span class="at">sort =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">method =</span> <span class="st">"AFINN"</span>)</span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a>summary_bing2 <span class="ot">&lt;-</span> sentiment_bing <span class="sc">%&gt;%</span> </span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(standards) <span class="sc">%&gt;%</span> </span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(sentiment, <span class="at">sort =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">method =</span> <span class="st">"bing"</span>)</span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-13"><a href="#cb64-13" aria-hidden="true" tabindex="-1"></a>summary_nrc2 <span class="ot">&lt;-</span> sentiment_nrc <span class="sc">%&gt;%</span> </span>
<span id="cb64-14"><a href="#cb64-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(sentiment <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"positive"</span>, <span class="st">"negative"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb64-15"><a href="#cb64-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(standards) <span class="sc">%&gt;%</span> </span>
<span id="cb64-16"><a href="#cb64-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(sentiment, <span class="at">sort =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb64-17"><a href="#cb64-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">method =</span> <span class="st">"nrc"</span>) </span>
<span id="cb64-18"><a href="#cb64-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-19"><a href="#cb64-19" aria-hidden="true" tabindex="-1"></a>summary_loughran2 <span class="ot">&lt;-</span> sentiment_loughran <span class="sc">%&gt;%</span> </span>
<span id="cb64-20"><a href="#cb64-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(sentiment <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"positive"</span>, <span class="st">"negative"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb64-21"><a href="#cb64-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(standards) <span class="sc">%&gt;%</span> </span>
<span id="cb64-22"><a href="#cb64-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(sentiment, <span class="at">sort =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb64-23"><a href="#cb64-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">method =</span> <span class="st">"loughran"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next, I’ll combine those four data frames together using the <code>bind_rows</code> function again:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>summary_sentiment <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(summary_afinn2,</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>                               summary_bing2,</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>                               summary_nrc2,</span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>                               summary_loughran2) <span class="sc">%&gt;%</span></span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(method, standards) <span class="sc">%&gt;%</span></span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(method)</span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a>summary_sentiment</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 16 × 4
# Groups:   standards [2]
   method   standards sentiment     n
   &lt;chr&gt;    &lt;chr&gt;     &lt;chr&gt;     &lt;int&gt;
 1 AFINN    ccss      negative    740
 2 AFINN    ccss      positive    477
 3 AFINN    ngss      positive    278
 4 AFINN    ngss      negative     45
 5 bing     ccss      negative    926
 6 bing     ccss      positive    446
 7 bing     ngss      positive    230
 8 bing     ngss      negative     66
 9 loughran ccss      negative    433
10 loughran ccss      positive    112
11 loughran ngss      negative     73
12 loughran ngss      positive     57
13 nrc      ccss      positive   2294
14 nrc      ccss      negative    766
15 nrc      ngss      positive    571
16 nrc      ngss      negative     79</code></pre>
</div>
</div>
<p>Then I’ll create a new data frame that has the total word counts for each set of standards and each method and join that to my <code>summary_sentiment</code> data frame:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>total_counts <span class="ot">&lt;-</span> summary_sentiment <span class="sc">%&gt;%</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(method, standards) <span class="sc">%&gt;%</span></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">total =</span> <span class="fu">sum</span>(n))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'method'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>sentiment_counts <span class="ot">&lt;-</span> <span class="fu">left_join</span>(summary_sentiment, total_counts)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(method, standards)`</code></pre>
</div>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>sentiment_counts</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 16 × 5
# Groups:   standards [2]
   method   standards sentiment     n total
   &lt;chr&gt;    &lt;chr&gt;     &lt;chr&gt;     &lt;int&gt; &lt;int&gt;
 1 AFINN    ccss      negative    740  1217
 2 AFINN    ccss      positive    477  1217
 3 AFINN    ngss      positive    278   323
 4 AFINN    ngss      negative     45   323
 5 bing     ccss      negative    926  1372
 6 bing     ccss      positive    446  1372
 7 bing     ngss      positive    230   296
 8 bing     ngss      negative     66   296
 9 loughran ccss      negative    433   545
10 loughran ccss      positive    112   545
11 loughran ngss      negative     73   130
12 loughran ngss      positive     57   130
13 nrc      ccss      positive   2294  3060
14 nrc      ccss      negative    766  3060
15 nrc      ngss      positive    571   650
16 nrc      ngss      negative     79   650</code></pre>
</div>
</div>
<p>Finally, I’ll add a new row that calculates the percentage of positive and negative words for each set of state standards:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>sentiment_percents <span class="ot">&lt;-</span> sentiment_counts <span class="sc">%&gt;%</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">percent =</span> n<span class="sc">/</span>total <span class="sc">*</span> <span class="dv">100</span>)</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>sentiment_percents</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 16 × 6
# Groups:   standards [2]
   method   standards sentiment     n total percent
   &lt;chr&gt;    &lt;chr&gt;     &lt;chr&gt;     &lt;int&gt; &lt;int&gt;   &lt;dbl&gt;
 1 AFINN    ccss      negative    740  1217    60.8
 2 AFINN    ccss      positive    477  1217    39.2
 3 AFINN    ngss      positive    278   323    86.1
 4 AFINN    ngss      negative     45   323    13.9
 5 bing     ccss      negative    926  1372    67.5
 6 bing     ccss      positive    446  1372    32.5
 7 bing     ngss      positive    230   296    77.7
 8 bing     ngss      negative     66   296    22.3
 9 loughran ccss      negative    433   545    79.4
10 loughran ccss      positive    112   545    20.6
11 loughran ngss      negative     73   130    56.2
12 loughran ngss      positive     57   130    43.8
13 nrc      ccss      positive   2294  3060    75.0
14 nrc      ccss      negative    766  3060    25.0
15 nrc      ngss      positive    571   650    87.8
16 nrc      ngss      negative     79   650    12.2</code></pre>
</div>
</div>
<p>Now that I have my sentiment percent summaries for each lexicon, I’m going to create my 100% stacked bar charts for each lexicon:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>sentiment_percents <span class="sc">%&gt;%</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> standards, <span class="at">y =</span> percent, <span class="at">fill=</span>sentiment)) <span class="sc">+</span></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">width =</span> .<span class="dv">8</span>, <span class="at">stat =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>method, <span class="at">ncol =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Public Sentiment on Twitter"</span>, </span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"The Common Core &amp; Next Gen Science Standards"</span>,</span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"State Standards"</span>, </span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Percentage of Words"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="lab-2-case-study_files/figure-html/unnamed-chunk-45-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>And finished! The chart above clearly illustrates that regardless of sentiment lexicon used, the NGSS contains more positive words than the CCSS lexicon.</p>
</section>
</section>
<section id="c.-narrate" class="level3">
<h3 class="anchored" data-anchor-id="c.-narrate">5c. Narrate</h3>
<p>With our “data products” cleanup complete, we can start pulling together a quick presentation to share with the class. We’ve already seen what a more formal journal article looks like in the PREPARE section of this walkthrough. For your Independent Analysis for Lab 2, you’ll be creating either a simple report or slide deck to share out some key findings from our analysis.</p>
<p>Regardless of whether you plan to talk us through your analysis and findings with a presentation or walk us through them with a brief written report, your assignment should address the following questions:</p>
<ol type="1">
<li><strong>Purpose</strong>. What question or questions are guiding your analysis? What did you hope to learn by answering these questions and why should your audience care about your findings?</li>
<li><strong>Methods</strong>. What data did you selected for analysis? What steps did you take to prepare your data for analysis and what techniques did you use to analyze your data? These should be fairly explicit with your embedded code.</li>
<li><strong>Findings</strong>. What did you ultimately find? How do your “data products” help to illustrate these findings? What conclusions can you draw from your analysis?</li>
<li><strong>Discussion</strong>. What were some of the strengths and weaknesses of your analysis? How might your audience use this information? How might you revisit or improve upon this analysis in the future?</li>
</ol>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>