<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.553">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="LASER Institute">
<meta name="dcterms.date" content="2024-07-20">

<title>Lab 4: Topic Modeling in MOOC-Eds</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="lab-4-case-study_files/libs/clipboard/clipboard.min.js"></script>
<script src="lab-4-case-study_files/libs/quarto-html/quarto.js"></script>
<script src="lab-4-case-study_files/libs/quarto-html/popper.min.js"></script>
<script src="lab-4-case-study_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="lab-4-case-study_files/libs/quarto-html/anchor.min.js"></script>
<link href="lab-4-case-study_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="lab-4-case-study_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="lab-4-case-study_files/libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="lab-4-case-study_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="lab-4-case-study_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="lab-4-case-study_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="lab-4-case-study_files/libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">0. INTRODUCTION</a>
  <ul>
  <li><a href="#walkthrough-focus" id="toc-walkthrough-focus" class="nav-link" data-scroll-target="#walkthrough-focus">Walkthrough Focus</a></li>
  </ul></li>
  <li><a href="#prepare" id="toc-prepare" class="nav-link" data-scroll-target="#prepare">1. PREPARE</a>
  <ul>
  <li><a href="#a.-context" id="toc-a.-context" class="nav-link" data-scroll-target="#a.-context">1a. Context</a>
  <ul class="collapse">
  <li><a href="#participating-in-a-mooc-and-professional-learning-team-how-a-blended-approach-to-professional-development-makes-a-difference" id="toc-participating-in-a-mooc-and-professional-learning-team-how-a-blended-approach-to-professional-development-makes-a-difference" class="nav-link" data-scroll-target="#participating-in-a-mooc-and-professional-learning-team-how-a-blended-approach-to-professional-development-makes-a-difference">Participating in a MOOC and Professional Learning Team: How a Blended Approach to Professional Development Makes a Difference</a></li>
  </ul></li>
  <li><a href="#b.-guiding-questions" id="toc-b.-guiding-questions" class="nav-link" data-scroll-target="#b.-guiding-questions">1b. Guiding Questions</a></li>
  <li><a href="#c.-set-up" id="toc-c.-set-up" class="nav-link" data-scroll-target="#c.-set-up">1c. Set Up</a></li>
  </ul></li>
  <li><a href="#wrangle" id="toc-wrangle" class="nav-link" data-scroll-target="#wrangle">2. WRANGLE</a>
  <ul>
  <li><a href="#a.-import-forum-data" id="toc-a.-import-forum-data" class="nav-link" data-scroll-target="#a.-import-forum-data">2a. Import Forum Data</a></li>
  <li><a href="#b.-cast-a-document-term-matrix" id="toc-b.-cast-a-document-term-matrix" class="nav-link" data-scroll-target="#b.-cast-a-document-term-matrix">2b. Cast a Document Term Matrix</a>
  <ul class="collapse">
  <li><a href="#functions-used" id="toc-functions-used" class="nav-link" data-scroll-target="#functions-used">Functions Used</a></li>
  <li><a href="#tidying-text" id="toc-tidying-text" class="nav-link" data-scroll-target="#tidying-text">Tidying Text</a></li>
  <li><a href="#creating-a-document-term-matrix" id="toc-creating-a-document-term-matrix" class="nav-link" data-scroll-target="#creating-a-document-term-matrix">Creating a Document Term Matrix</a></li>
  </ul></li>
  <li><a href="#c.-to-stem-or-not-to-stem" id="toc-c.-to-stem-or-not-to-stem" class="nav-link" data-scroll-target="#c.-to-stem-or-not-to-stem">2c. To Stem or not to Stem?</a>
  <ul class="collapse">
  <li><a href="#processing-and-stemming-for-stm" id="toc-processing-and-stemming-for-stm" class="nav-link" data-scroll-target="#processing-and-stemming-for-stm">Processing and Stemming for STM</a></li>
  <li><a href="#stemming-tidy-text" id="toc-stemming-tidy-text" class="nav-link" data-scroll-target="#stemming-tidy-text">Stemming Tidy Text</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#model" id="toc-model" class="nav-link" data-scroll-target="#model">3. MODEL</a>
  <ul>
  <li><a href="#a.-fitting-a-topic-modeling-with-lda" id="toc-a.-fitting-a-topic-modeling-with-lda" class="nav-link" data-scroll-target="#a.-fitting-a-topic-modeling-with-lda">3a. Fitting a Topic Modeling with LDA</a></li>
  <li><a href="#b.-fitting-a-structural-topic-model" id="toc-b.-fitting-a-structural-topic-model" class="nav-link" data-scroll-target="#b.-fitting-a-structural-topic-model">3b. Fitting a Structural Topic Model</a>
  <ul class="collapse">
  <li><a href="#the-stm-package" id="toc-the-stm-package" class="nav-link" data-scroll-target="#the-stm-package">The <code>stm</code> Package</a></li>
  </ul></li>
  <li><a href="#c.-finding-k" id="toc-c.-finding-k" class="nav-link" data-scroll-target="#c.-finding-k">3c. Finding <em>K</em></a>
  <ul class="collapse">
  <li><a href="#the-findtopicsnumber-function" id="toc-the-findtopicsnumber-function" class="nav-link" data-scroll-target="#the-findtopicsnumber-function">The FindTopicsNumber Function</a></li>
  <li><a href="#the-findingk-function" id="toc-the-findingk-function" class="nav-link" data-scroll-target="#the-findingk-function">The findingK() Function</a></li>
  <li><a href="#the-ldavis-explorer" id="toc-the-ldavis-explorer" class="nav-link" data-scroll-target="#the-ldavis-explorer">The LDAvis Explorer</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#explore" id="toc-explore" class="nav-link" data-scroll-target="#explore">4. EXPLORE</a>
  <ul>
  <li><a href="#a.-exploring-beta-values" id="toc-a.-exploring-beta-values" class="nav-link" data-scroll-target="#a.-exploring-beta-values">4a. Exploring Beta Values</a></li>
  <li><a href="#b.-exploring-gamma-values" id="toc-b.-exploring-gamma-values" class="nav-link" data-scroll-target="#b.-exploring-gamma-values">4b. Exploring Gamma Values</a></li>
  <li><a href="#c.-reading-the-tea-leaves" id="toc-c.-reading-the-tea-leaves" class="nav-link" data-scroll-target="#c.-reading-the-tea-leaves">4c. Reading the Tea Leaves</a>
  <ul class="collapse">
  <li><a href="#takeaway" id="toc-takeaway" class="nav-link" data-scroll-target="#takeaway">Takeaway</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Lab 4: Topic Modeling in MOOC-Eds</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>LASER Institute </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">July 20, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">0. INTRODUCTION</h2>
<p>This case study walkthrough extends previous research and evaluation work at the Friday Institute for Educational Innovation at North Carolina State University. In addition to many other areas of inquiry, this work was aimed at understanding and improving peer interaction and discussion in the Friday Institute’s Massively Open Online Courses for Educators (MOOC-Ed) and Online Professional Learning programs. To learn more about these courses and programs, visit: <a href="https://place.fi.ncsu.edu" class="uri">https://place.fi.ncsu.edu</a></p>
<section id="walkthrough-focus" class="level3">
<h3 class="anchored" data-anchor-id="walkthrough-focus">Walkthrough Focus</h3>
<p>Our focus will be on identifying “topics” by examining how words cohere into different latent, or hidden, themes based on patterns of co-occurrence of words within documents. With a bit of tongue-in-cheek,&nbsp;<a href="http://journalofdigitalhumanities.org/2-1/dh-contribution-to-topic-modeling/">Meeks and Weingart (2012)</a>&nbsp;describe topic modeling as:&nbsp;</p>
<blockquote class="blockquote">
<p><em>…focused on corpora and not individual texts, treating the works themselves as unceremonious ‘buckets of words,’ and providing seductive but obscure results in the forms of easily interpreted (and manipulated) ‘topics’…. To achieve its results, it leverages occult statistical methods like ‘dirichlet priors’ and ‘bayesian models.’</em></p>
</blockquote>
<p>That being said, <a href="http://journalofdigitalhumanities.org/2-1/dh-contribution-to-topic-modeling/">Weingart</a> also noted that “a topic model is a”clever and exceptionally versatile little algorithm that can be customized to all sorts of applications” and <a href="https://sicss.io/2020/materials/day3-text-analysis/topic-modeling/rmarkdown/Topic_Modeling.html#running-your-first-topic-model">Bail (2020)</a> add that topic modeling can be “a powerful tool for identifying general trends in a corpus that can then be analyzed in a more granular manner using other techniques.”</p>
<p>With respect to the actual R workflow of applying topic models to documents and text of interests, Silge &amp; Robinson and a new bottom row their flowchart consisting new data structures (i.e., a corpus object and document-term matrix) and and the LDA model: &nbsp;</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="https://www.tidytextmining.com/topicmodeling.html"><img src="img/tm_flow.png" title="A flowchart of a text analysis that incorporates topic modeling. The topicmodels package takes a Document-Term Matrix as input and produces a model that can be tided by tidytext, such that it can be manipulated and visualized with dplyr and ggplot2." class="img-fluid figure-img" style="width:90.0%" alt="Figure&nbsp;source:&nbsp;Silge,&nbsp;J.,&nbsp;&amp;&nbsp;Robinson,&nbsp;D.&nbsp;(2017).&nbsp;Text&nbsp;mining&nbsp;with&nbsp;R:&nbsp;A&nbsp;tidy&nbsp;approach.&nbsp;O’Reilly&nbsp;Media,&nbsp;Inc.&nbsp;Retrieved from: https://www.tidytextmining.com/topicmodeling.html"></a></p>
<figcaption>Figure&nbsp;source:&nbsp;Silge,&nbsp;J.,&nbsp;&amp;&nbsp;Robinson,&nbsp;D.&nbsp;(2017).&nbsp;Text&nbsp;mining&nbsp;with&nbsp;R:&nbsp;A&nbsp;tidy&nbsp;approach.&nbsp;O’Reilly&nbsp;Media,&nbsp;Inc.&nbsp;Retrieved from: https://www.tidytextmining.com/topicmodeling.html</figcaption>
</figure>
</div>
<p>As noted by Krumm and Means (2018), this workflow is not always a linear process and there is often a great deal of iteration that occurs within and between wrangling, exploring, modeling. As illustrated by our workflow below, we will primarily explore our data after the modeling process in order to gain some additional insight into the topics generated by our model. Specifically, this walkthrough covers the following concepts and skills:</p>
<ol type="1">
<li><strong>Prepare</strong>: Prior to analysis, we’ll take a quick look at some of the related MOOC-Ed research and evaluation work to gain some context for our analysis. This should aid in the interpretation of our results and help guide some decisions as we tidy, model, and visualize our data.</li>
<li><strong>Wrangle</strong>: In section 2 we again revisit tidying and tokenizing text using the <code>tidytext</code> package but are also introduced to the the <code>stm</code> package. This package makes use of <code>tm</code> text mining package to preprocess text and will also be our first introduction to word stemming.</li>
<li><strong>Model</strong>: We take a look at two different approaches to topic modeling: Latent Dirichlet Allocation (LDA) and Structural Topic Modeling (STM), which is very similar to LDA but can use metadata about documents to improve the assignment of words to “topics” in a corpus and examine relationships between topics and covariates. We will focus on LDA in the zoom meeting.</li>
<li><strong>Explore</strong>: To further explore the results of our topic model, we use several handy functions from the <code>topicmodels</code> and <code>stm</code> packages, including the <code>findThoughts</code> function for viewing documents assigned to a given topic and the <code>toLDAvis</code> function for exploring topic and word distributions.</li>
</ol>
<hr>
</section>
</section>
<section id="prepare" class="level2">
<h2 class="anchored" data-anchor-id="prepare">1. PREPARE</h2>
<p>To help us better understand the context, questions, and data sources we’ll be using, this section will focus on the following topics:</p>
<ol type="a">
<li><strong>Context</strong>. As context for our analysis, we’ll review several related papers by my colleagues relevant to the analysis of MOOC-Ed discussion forums.</li>
<li><strong>Questions.</strong> We’ll also examine what insight topic modeling can provide to a question that we asked participants answer in their professional learning teams (PLTs).</li>
<li><strong>Project Setup.</strong> This should be very familiar by now, but we’ll set up a new R project and install and load the required packages for the topic modeling walkthrough.</li>
</ol>
<section id="a.-context" class="level3">
<h3 class="anchored" data-anchor-id="a.-context">1a. Context</h3>
<section id="participating-in-a-mooc-and-professional-learning-team-how-a-blended-approach-to-professional-development-makes-a-difference" class="level4">
<h4 class="anchored" data-anchor-id="participating-in-a-mooc-and-professional-learning-team-how-a-blended-approach-to-professional-development-makes-a-difference">Participating in a MOOC and Professional Learning Team: How a Blended Approach to Professional Development Makes a Difference</h4>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="https://place.fi.ncsu.edu/local/catalog/course.php?id=4&amp;ref=1"><img src="img/tsdi.png" title="Our world is rich with data sources, and technology makes data more accessible than ever before! To help ensure students are future ready to use data for making informed decisions, many countries around the world have increased the emphasis on statistics and data analysis in school curriculum–from elementary/primary grades through college. This course allows you to learn, along with colleagues from other schools, an investigation cycle to teach statistics and to help students explore data to make evidence-based claims. To learn more about engaging learners in making inferences and claims supported by data and how to emphasize inferential reasoning in teaching statistics through posing different types of investigative questions, enroll in our Teaching Statistics through Inferential Reasoning MOOC-Ed." class="img-fluid figure-img" style="width:50.0%" alt="Teaching Statistics Through Data Investigations MOOC-Ed"></a></p>
<figcaption>Teaching Statistics Through Data Investigations MOOC-Ed</figcaption>
</figure>
</div>
<p>Full text: <a href="https://www.learntechlib.org/p/195234/" class="uri">https://www.learntechlib.org/p/195234/</a></p>
<p><strong>Abstract</strong></p>
<p>Massive Open Online Courses for Educators (MOOC-Eds) provide opportunities for using research-based learning and teaching practices, along with new technological tools and facilitation approaches for delivering quality online professional development. The Teaching Statistics Through Data Investigations MOOC-Ed was built for preparing teachers in pedagogy for teaching statistics, and it has been offered to participants from around the world. During 2016-2017, professional learning teams (PLTs) were formed from a subset of MOOC-Ed participants. These teams met several times to share and discuss their learning and experiences. This study focused on examining the ways that a blended approach to professional development may result in similar or different patterns of engagement to those who only participate in a large-scale online course. Results show the benefits of a blended learning environment for retention, engagement with course materials, and connectedness within the online community of learners in an online professional development on teaching statistics. The findings suggest the use of self-forming autonomous PLTs for supporting a deeper and more comprehensive experience with self-directed online professional developments such as MOOCs. Other online professional development courses, such as MOOCs, may benefit from purposely suggesting and advertising, and perhaps facilitating, the formation of small face-to-face or virtual PLTs who commit to engage in learning together.</p>
<p><strong>Data Source &amp; Analysis</strong></p>
<p>All peer interaction, including peer discussion, take place within discussion forums of MOOC-Eds, which are hosted using the Moodle Learning Management System. To build the dataset you’ll be using for this walkthrough, the research team wrote a query for Moodle’s MySQL database, which records participants’ user-logs of activity in the online forums. This sql query combines separate database tables containing postings and comments including participant IDs, timestamps, discussion text and other attributes or “metadata.”</p>
<p>For further description of the forums and data retrieval process, see also the following papers:</p>
<ul>
<li><p>Kellogg, S., &amp; Edelmann, A. (2015). <a href="https://bera-journals.onlinelibrary.wiley.com/doi/pdfdirect/10.1111/bjet.12312">Massively Open Online Course for Educators (MOOC‐Ed) network dataset</a>.&nbsp;<em>British journal of educational technology</em>,&nbsp;<em>46</em>(5), 977-983.</p></li>
<li><p>Ezen-Can, A., Boyer, K. E., Kellogg, S., &amp; Booth, S. (2015, March). <a href="https://dl.acm.org/doi/pdf/10.1145/2723576.2723589">Unsupervised modeling for understanding MOOC discussion forums: a learning analytics approach</a>. In&nbsp;<em>Proceedings of the fifth international conference on learning analytics and knowledge</em>&nbsp;(pp.&nbsp;146-150).</p></li>
<li><p>Kellogg, S., Booth, S., &amp; Oliver, K. (2014). <a href="https://www.erudit.org/en/journals/irrodl/1900-v1-n1-irrodl04945/1065545ar.pdf">A social network perspective on peer supported learning in MOOCs for educators.</a>&nbsp;<em>International Review of Research in Open and Distributed Learning</em>,&nbsp;<em>15</em>(5), 263-289.</p></li>
</ul>
<p><strong>Summary of Key Findings</strong></p>
<p>The following highlight some key findings related to the discussion forums in the papers cited above:</p>
<ol type="1">
<li>MOOCs designed specifically for K-12 teachers can provide positive self-directed learning experiences and rich engagement in discussion forums that help form online communities for educators.</li>
<li>Analysis of discussion forum data in TSDI provided a very clear picture of how enthusiastic many PLT members and leaders were to talk to others in the online community. They posed their questions and shared ideas with others about teaching statistics throughout the units, even though they were also meeting synchronously several times with their colleagues in small group PLTs.</li>
<li>Findings on knowledge construction demonstrated that over half of the discussions in both courses moved beyond sharing information and statements of agreement and entered a process of dissonance, negotiation and co-construction of knowledge, but seldom moved beyond this phase in which new knowledge was tested or applied. These findings echo similar research on difficulties in promoting knowledge construction in online settings.</li>
<li>Topic modeling provides more interpretable and cohesive models for discussion forums than other popular unsupervised modeling techniques such as k-means and k-medoids clustering algorithms.</li>
</ol>
</section>
</section>
<section id="b.-guiding-questions" class="level3">
<h3 class="anchored" data-anchor-id="b.-guiding-questions">1b. Guiding Questions</h3>
<p>For the paper, <a href="https://www.learntechlib.org/p/195234/"><em>Participating in a MOOC and Professional Learning Team: How a Blended Approach to Professional Development Makes a Difference</em></a>, the researchers were interested in unpacking how participants who enrolled in the Teaching Statistics through Data Investigations MOOC-Ed might benefit from also being in a smaller group of professionals committed to engaging in the same professional development. The specific research question for this paper was:</p>
<blockquote class="blockquote">
<p>What are the similarities and differences between how PLT members and Non-PLT online participants engage and meet course goals in a MOOC-Ed designed for educators in secondary and collegiate settings?</p>
</blockquote>
<p>Dr.&nbsp;Hollylynne Lee and the TSDI team also developed a facilitation guide designed specifically for PLT teams to help groups synthesize the ideas in the course and make plans for how to implement new strategies in their classroom in order to impact students’ learning of statistics. One question PLT members were asked to address was:</p>
<blockquote class="blockquote">
<p>What ideas or issues emerged in the discussion forums this past week?</p>
</blockquote>
<p>For this walkthrough, we will further examine that question through the use of topic modeling.</p>
<p>One overarching question that Silge and Robinson (2018) identify as a central question to text mining and natural language processing, is:</p>
<blockquote class="blockquote">
<p>How do we to <strong>quantify</strong> what a document or collection of documents is about?</p>
</blockquote>
</section>
<section id="c.-set-up" class="level3">
<h3 class="anchored" data-anchor-id="c.-set-up">1c. Set Up</h3>
<p>First, let’s load the following packages that we’ll be needing for this walkthrough:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidytext)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(SnowballC)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(topicmodels)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stm)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ldatuning)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(LDAvis)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
</section>
</section>
<section id="wrangle" class="level2">
<h2 class="anchored" data-anchor-id="wrangle">2. WRANGLE</h2>
<p>Data wrangling involves some combination of cleaning, reshaping, transforming, and merging data (Wickham &amp; Grolemund, 2017). We’ll revisit tidying and tokenizing text using the <code>tidytext</code> package, but are also introduced to the the <code>stm</code> package. This package makes use of <code>tm</code> text mining package to preprocess text (e.g., removing punctuation, stop words, etc.) and will also be our first introduction to word stemming.</p>
<ol type="a">
<li><strong>Import Data</strong>. We’ll be working with .csv files and the <code>read_csv()</code> function but will introduce a new argument for changing column types.</li>
<li><strong>Cast a DTM</strong>. We revisit the <code>tidytext</code> package to “tidy” and tokenize our forum data and introduce the <code>cast_dtm()</code> function to create the document term matrix (dtm) need for topic modeling.</li>
<li><strong>To Stem or not to STEM?</strong> We conclude our data wrangling by also introducing the <code>textProcessor()</code> function for preprocessing and discuss the pros and cons of word stemming.</li>
</ol>
<section id="a.-import-forum-data" class="level3">
<h3 class="anchored" data-anchor-id="a.-import-forum-data">2a. Import Forum Data</h3>
<p>To get started, we need to import, or “read”, our data into R. The function used to import your data will depend on the file format of the data you are trying to import. First, however, you’ll need to do the following:</p>
<ol type="1">
<li>Download the <code>ts_forum_data.csv</code> file we’ll be using.</li>
<li>Create a folder in the directory on your computer where you stored your R Project and name it “data”.</li>
<li>Add the file to your data folder.</li>
<li>Check your Files tab in RStudio to verify that your file is indeed in your data folder.</li>
</ol>
<p>Now let’s read our data into our Environment using the <code>read_csv()</code> function and assign it to a variable name so we can work with it like any other object in R.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>ts_forum_data <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/ts_forum_data.csv"</span>, </span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">col_types =</span> <span class="fu">cols</span>(<span class="at">course_id =</span> <span class="fu">col_character</span>(),</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">forum_id =</span> <span class="fu">col_character</span>(), </span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">discussion_id =</span> <span class="fu">col_character</span>(), </span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>                   <span class="at">post_id =</span> <span class="fu">col_character</span>()</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>                   )</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>By default, many of the columns like <code>course_id</code> and <code>forum_id</code> are read in as numeric data. For our purposes, we plan to treat them as unique identifiers or names for out courses, forums, discussions, and posts. The <code>read_csv()</code> function has a handy <code>col_types =</code> argument changing the column types from numeric to characters.</p>
</section>
<section id="b.-cast-a-document-term-matrix" class="level3">
<h3 class="anchored" data-anchor-id="b.-cast-a-document-term-matrix">2b. Cast a Document Term Matrix</h3>
<p>In this section we’ll revisit some familiar <code>tidytext</code> functions used in sentiment analysis for tidying and tokenizing text and introduce some new functions from the <code>stm</code> package for processing text and transforming our data frames into new data structures required for topic modeling.</p>
<section id="functions-used" class="level4">
<h4 class="anchored" data-anchor-id="functions-used">Functions Used</h4>
<p><strong><code>tidytext</code> functions</strong></p>
<ul>
<li><code>unnest_tokens()</code> splits a column into tokens</li>
<li><code>anti_join()</code> returns all rows from x without a match in y and used to remove <code>stop words</code> from out data.</li>
<li><code>cast_dtm()</code> takes a tidied data frame take and “casts” it into a document-term matrix (dtm)</li>
</ul>
<p><strong><code>dplyr</code></strong> <strong>functions</strong></p>
<ul>
<li><code>count()</code> lets you quickly count the unique values of one or more variables</li>
<li><code>group_by()</code> takes a data frame and one or more variables to group by</li>
<li><code>summarise()</code> creates a summary of data using arguments like sum and mean</li>
</ul>
<p><strong><code>stm</code> functions</strong></p>
<ul>
<li><code>textProcessor()</code> takes in a vector or column of raw texts and performs text processing like removing punctuation and word stemming.</li>
<li><code>prepDocuments()</code> performs several corpus manipulations including removing words and renumbering word indices</li>
</ul>
</section>
<section id="tidying-text" class="level4">
<h4 class="anchored" data-anchor-id="tidying-text">Tidying Text</h4>
<p>Prior to topic modeling, we have a few remaining steps to tidy our text. These preprocessing steps include:</p>
<ol type="1">
<li>Transforming our text into “tokens”</li>
<li>Removing unnecessary characters, punctuation, and whitespace</li>
<li>Converting all text to lowercase</li>
<li>Removing stop words such as “the”, “of”, and “to”</li>
</ol>
<p>Let’s tokenize our forum text and by using the familiar <code>unnest_tokens()</code> and remove stop words:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>forums_tidy <span class="ot">&lt;-</span> ts_forum_data <span class="sc">%&gt;%</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_tokens</span>(<span class="at">output =</span> word, <span class="at">input =</span> post_content) <span class="sc">%&gt;%</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">anti_join</span>(stop_words, <span class="at">by =</span> <span class="st">"word"</span>)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>forums_tidy</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 192,160 × 14
   course_id course_name       forum_id forum_name discussion_id discussion_name
   &lt;chr&gt;     &lt;chr&gt;             &lt;chr&gt;    &lt;chr&gt;      &lt;chr&gt;         &lt;chr&gt;          
 1 9         Teaching Statist… 126      Investiga… 6822          Not much compa…
 2 9         Teaching Statist… 126      Investiga… 6822          Not much compa…
 3 9         Teaching Statist… 126      Investiga… 6822          Not much compa…
 4 9         Teaching Statist… 126      Investiga… 6822          Not much compa…
 5 9         Teaching Statist… 126      Investiga… 6822          Not much compa…
 6 9         Teaching Statist… 126      Investiga… 6822          Not much compa…
 7 9         Teaching Statist… 126      Investiga… 6822          Not much compa…
 8 9         Teaching Statist… 126      Investiga… 6822          Not much compa…
 9 9         Teaching Statist… 126      Investiga… 6822          Not much compa…
10 9         Teaching Statist… 126      Investiga… 6822          Not much compa…
# ℹ 192,150 more rows
# ℹ 8 more variables: discussion_creator &lt;dbl&gt;, discussion_poster &lt;dbl&gt;,
#   discussion_reference &lt;chr&gt;, parent_id &lt;dbl&gt;, post_date &lt;chr&gt;,
#   post_id &lt;chr&gt;, post_title &lt;chr&gt;, word &lt;chr&gt;</code></pre>
</div>
</div>
<p>Now let’s do a quick word count to see some of the most common words used throughout the forums. This should get a sense of what we’re working with and later we’ll need these word counts for creating our document term matrix for topic modeling:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>forums_tidy <span class="sc">%&gt;%</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(word, <span class="at">sort =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 13,620 × 2
   word           n
   &lt;chr&gt;      &lt;int&gt;
 1 students    6841
 2 data        4365
 3 statistics  3103
 4 school      1488
 5 questions   1470
 6 class       1426
 7 font        1311
 8 span        1267
 9 time        1253
10 style       1150
# ℹ 13,610 more rows</code></pre>
</div>
</div>
<p>Terms like “students,” “data,” and “class” are about what we would have expected from a course teaching statistics. The term “agree” and “time” however, are not so intuitive and worth a quick look as well.</p>
<section id="comprehension-check" class="level5">
<h5 class="anchored" data-anchor-id="comprehension-check">✅ Comprehension Check</h5>
<p>Use the <code>filter()</code> and <code>grepl()</code> functions to filter for rows in our <code>ts_forum_data</code> data frame that contain the terms “agree” and “time” and another term or terms of your choosing. Select a random sample of 10 posts using the <code>sample_n()</code> function for your terms and answer the following questions:</p>
<ol type="1">
<li><p>What, if anything, do these posts have in common?</p></li>
<li><p>What topics or themes might be apparent, or do you anticipate emerging, from our topic modeling?</p></li>
</ol>
<p>Your output should look something like this:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 1
   post_content                                                                 
   &lt;chr&gt;                                                                        
 1 "I agree.  It was good to see how the same data set looked different for the…
 2 "I agree that it is difficult to get students to pose questions. I teach onl…
 3 "Dear Hollylynne Lee  all participants and the Teaching Statistics Design Te…
 4 "After looking through the examples  it made me think about the Black-Schole…
 5 "I was interested to hear Dr. Webster West talk about how Probability and St…
 6 "My students have the hardest time year in and year out trying to identify t…
 7 "I agree that this was probably a pre-assessment  but I wish I had known tha…
 8 "in the old faithful data there was a lot of data that deal with the blast  …
 9 "I really like Paige's suggestion for the opening week activity.  I think it…
10 "I really enjoyed the video on Statcrunch.  Just listening to the dialogue b…</code></pre>
</div>
</div>
</section>
</section>
<section id="creating-a-document-term-matrix" class="level4">
<h4 class="anchored" data-anchor-id="creating-a-document-term-matrix">Creating a Document Term Matrix</h4>
<p>As highlighted in <a href="https://www.tidytextmining.com/dtm.html#cast-dtm">Chapter 5 of Text Mining with R</a>, the <code>topicmodels</code> package and the <a href="https://www.tidytextmining.com/topicmodeling.html#latent-dirichlet-allocation">Latent Dirichlet allocation (LDA)</a> algorithm and <code>LDA()</code> function it uses expects document-term matrix as the data input.</p>
<p>Before we create a our document-term matrix, however, we have an important decision to make:</p>
<blockquote class="blockquote">
<p><strong>What do we consider to be a “document” in a MOOC-Ed discussion forum?</strong></p>
</blockquote>
<p>For example, we could consider each individual discussion post, or <code>post_id</code> in our data frame, as a document. It might also make sense to combine texts from all posts within each discussion, or <code>disccussion_id</code>, and consider that as a document since these posts are often interconnected an build off one another.</p>
<p>For now, however, let treat each individual post as a unique “document.” noted above, to create our document term matrix, we’ll need to first <code>count()</code> how many times each <code>word</code> occurs in each document, or <code>post_id</code> in our case, and create a matrix that contains one row per post as our original data frame did, but now contains a column for each <code>word</code> in the entire corpus and a value of <code>n</code> for how many times that word occurs in each post.</p>
<p>To create this document term matrix from our post counts, we’ll use the <code>cast_dtm()</code> function like so and assign it to the variable <code>forums_dtm</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>forums_dtm <span class="ot">&lt;-</span> forums_tidy <span class="sc">%&gt;%</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(post_id, word) <span class="sc">%&gt;%</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cast_dtm</span>(post_id, word, n)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="comprehension-check-1" class="level5">
<h5 class="anchored" data-anchor-id="comprehension-check-1">✅ Comprehension Check</h5>
<p>Take a look at our <code>forums_dtm</code> object in the console and answer the following question:</p>
<ol type="1">
<li>What “class” of object is <code>forums_dtm</code>?</li>
<li>How many unique documents and terms are included our matrix?</li>
<li>Why might there be fewer documents/posts than were in our original data frame?</li>
<li>What exactly is meant by “sparsity”?</li>
</ol>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] "DocumentTermMatrix"    "simple_triplet_matrix"</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;&lt;DocumentTermMatrix (documents: 5766, terms: 13620)&gt;&gt;
Non-/sparse entries: 142641/78390279
Sparsity           : 100%
Maximal term length: NA
Weighting          : term frequency (tf)</code></pre>
</div>
</div>
</section>
</section>
</section>
<section id="c.-to-stem-or-not-to-stem" class="level3">
<h3 class="anchored" data-anchor-id="c.-to-stem-or-not-to-stem">2c. To Stem or not to Stem?</h3>
<p>Next we’ll need to prepare our original data set for structural topic modeling using the <code>textProcessor()</code> function. The <code>stm</code> package has a number of features that extend the functionality of the <code>topicmodels</code> package, including an argument for “stemming” words, which <a href="https://direct.mit.edu/tacl/article/doi/10.1162/tacl_a_00099/43370/Comparing-Apples-to-Apple-The-Effects-of-Stemmers">Schofield and Mimno (2016)</a> describe as follows:</p>
<blockquote class="blockquote">
<p>Stemming is a popular way to reduce the size of a vocabulary in natural language tasks by conflating words with related meanings. Specifically, stemming aims to convert words with the same “stem” or root (e.g “creative” and “creator”) to a single word type (“create”). Though originally developed in the context of information retrieval (IR) systems, stemmers are now commonly used as a preprocessing step in unsupervised machine learning tasks.</p>
</blockquote>
<p>The rationale behind stemming is that it can dramatically reduce the number of words or terms to be modeled, which in theory should help simplify and improve the performance of your model. We’ll explore this assumption a little later in this section.</p>
<section id="processing-and-stemming-for-stm" class="level4">
<h4 class="anchored" data-anchor-id="processing-and-stemming-for-stm">Processing and Stemming for STM</h4>
<p>Like <code>unnest_tokens()</code>, the <code>textProcessor()</code> function includes several useful arguments for processing text like converting text to lowercase and removing punctuation and numbers. I’ve included several of these in the script below along with their defaults used if you do not explicitly specify in your function. Most of these are pretty intuitive and you can learn more by viewing the <code>?textProcessor</code> documentation.</p>
<p>Let’s go ahead and process our discussion forum <code>post_content</code> in preparation for structural topic modeling:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>temp <span class="ot">&lt;-</span> <span class="fu">textProcessor</span>(ts_forum_data<span class="sc">$</span>post_content, </span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">metadata =</span> ts_forum_data,  </span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">lowercase=</span><span class="cn">TRUE</span>, </span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>                    <span class="at">removestopwords=</span><span class="cn">TRUE</span>, </span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>                    <span class="at">removenumbers=</span><span class="cn">TRUE</span>,  </span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>                    <span class="at">removepunctuation=</span><span class="cn">TRUE</span>, </span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>                    <span class="at">wordLengths=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="cn">Inf</span>),</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>                    <span class="at">stem=</span><span class="cn">TRUE</span>,</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>                    <span class="at">onlycharacter=</span> <span class="cn">FALSE</span>, </span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>                    <span class="at">striphtml=</span><span class="cn">TRUE</span>, </span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>                    <span class="at">customstopwords=</span><span class="cn">NULL</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Building corpus... 
Converting to Lower Case... 
Removing punctuation... 
Removing stopwords... 
Removing numbers... 
Stemming... 
Creating Output... </code></pre>
</div>
</div>
<p>Note that the first argument the <code>textProcessor</code> function expects is the column in our data frame that contains the text to be processed, the second argument <code>metadata =</code> expects the data frame that contains the text of interest and uses the column names to label the metadata such as course ids and forum names. This metadata can be used to to improve the assignment of words to topics in a corpus and examine the relationship between topics and various covariates of interest.</p>
<p>Unlike the <code>unnest_tokens()</code> function, the output is not a nice tidy data frame. Topic modeling using the <code>stm</code> package requires a very unique set of inputs that are specific to the package. The following code will pull elements from the <code>temp</code> list that was created that will be required for the <code>stm()</code> function we’ll use in Section 4:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>meta <span class="ot">&lt;-</span> temp<span class="sc">$</span>meta</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>vocab <span class="ot">&lt;-</span> temp<span class="sc">$</span>vocab</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>docs <span class="ot">&lt;-</span> temp<span class="sc">$</span>documents</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="stemming-tidy-text" class="level4">
<h4 class="anchored" data-anchor-id="stemming-tidy-text">Stemming Tidy Text</h4>
<p>Notice that the <code>textProcessor</code> stem argument we used above is set to <code>TRUE</code> by default. We haven’t introduced word stemming at this point because there is some debate about the actual value of this process. While words like “students” and “student” might make sense to collapse into their base word and actually make analyses and visualizations more concise and easier to interpret. <a href="https://smltar.com/stemming.html">Hvitfeldt and Silge (2021)</a> note, however, that words like the following have dramatic differences in meaning, semantics, and use and could result in poor models or misinterpreted results:</p>
<ul>
<li>meaning and mean</li>
<li>likely, like, liking</li>
<li>university and universe</li>
</ul>
<p>The first word pair is particularly relevant to discussion posts from our Teaching Statistics course data. In addition, collapsing words like “teachers” and “teaching” could dramatically alter the results from a topic model.</p>
<p><a href="https://direct.mit.edu/tacl/article/doi/10.1162/tacl_a_00099/43370/Comparing-Apples-to-Apple-The-Effects-of-Stemmers">Schofield and Mimno (2016)</a> specifically,</p>
<blockquote class="blockquote">
<p><em>Despite their frequent use in topic modeling, we find that stemmers produce no meaningful improvement in likelihood and coherence and in fact can degrade topic stability.</em></p>
</blockquote>
<p>For now, we will leave as is the <code>forums_dtm</code> we created earlier with words unstemmed, but what if we wanted to stem words in a “tidy” way?</p>
<p>Since the <code>unnest_tokens()</code> function does not (intentionally I believe) include a stemming function, one approach would be to use the <code>wordStem()</code> function from the <code>snowballC</code> package to either replace our <code>words</code> column with a word stems or create a new variable called <code>stem</code> with our stemmed words. Let’s do the latter and take a look at the original words and the stem that was produced:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>stemmed_forums <span class="ot">&lt;-</span> ts_forum_data <span class="sc">%&gt;%</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_tokens</span>(<span class="at">output =</span> word, <span class="at">input =</span> post_content) <span class="sc">%&gt;%</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">anti_join</span>(stop_words, <span class="at">by =</span> <span class="st">"word"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">stem =</span> <span class="fu">wordStem</span>(word))</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>stemmed_forums</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 192,160 × 15
   course_id course_name       forum_id forum_name discussion_id discussion_name
   &lt;chr&gt;     &lt;chr&gt;             &lt;chr&gt;    &lt;chr&gt;      &lt;chr&gt;         &lt;chr&gt;          
 1 9         Teaching Statist… 126      Investiga… 6822          Not much compa…
 2 9         Teaching Statist… 126      Investiga… 6822          Not much compa…
 3 9         Teaching Statist… 126      Investiga… 6822          Not much compa…
 4 9         Teaching Statist… 126      Investiga… 6822          Not much compa…
 5 9         Teaching Statist… 126      Investiga… 6822          Not much compa…
 6 9         Teaching Statist… 126      Investiga… 6822          Not much compa…
 7 9         Teaching Statist… 126      Investiga… 6822          Not much compa…
 8 9         Teaching Statist… 126      Investiga… 6822          Not much compa…
 9 9         Teaching Statist… 126      Investiga… 6822          Not much compa…
10 9         Teaching Statist… 126      Investiga… 6822          Not much compa…
# ℹ 192,150 more rows
# ℹ 9 more variables: discussion_creator &lt;dbl&gt;, discussion_poster &lt;dbl&gt;,
#   discussion_reference &lt;chr&gt;, parent_id &lt;dbl&gt;, post_date &lt;chr&gt;,
#   post_id &lt;chr&gt;, post_title &lt;chr&gt;, word &lt;chr&gt;, stem &lt;chr&gt;</code></pre>
</div>
</div>
<p>You can see that words like “activity” and “activities” that occur frequently in our discussions have been reduced to the word stem “activ”. If you are interested in learning other approaches for word stemming in R, as well as reading a more in depth description of the stemming process, I highly recommend the <a href="https://smltar.com/stemming.html">Chapter 4 Stemming</a> from Hvitfeldt and Silge (2021) book, <em>Supervised Machine Learning for Text Analysis in R</em>.</p>
<section id="comprehension-check-2" class="level5">
<h5 class="anchored" data-anchor-id="comprehension-check-2">✅ Comprehension Check</h5>
<p>Complete the following code using what we learned in the section on <a href="#creating-a-document-term-matrix">Creating a Document Term Matrix</a> and answer the following questions:</p>
<ol type="1">
<li>How many fewer terms are in our stemmed document term matrix?</li>
<li>Did stemming words significantly reduce the sparsity of the network?</li>
</ol>
<p><strong>Hint:</strong> Make sure your code includes stem counts rather than word counts.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>stemmed_dtm <span class="ot">&lt;-</span> ts_forum_data <span class="sc">%&gt;%</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_tokens</span>(<span class="at">output =</span> word, <span class="at">input =</span> post_content) <span class="sc">%&gt;%</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">anti_join</span>(stop_words, <span class="at">by =</span> <span class="st">"word"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">stem =</span> <span class="fu">wordStem</span>(word)) <span class="sc">%&gt;%</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">______</span>() <span class="sc">%&gt;%</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">______</span>() <span class="sc">%&gt;%</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>stemmed_dtm</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10,001 × 2
   stem         n
   &lt;chr&gt;    &lt;int&gt;
 1 student   7354
 2 data      4365
 3 statist   4161
 4 question  2470
 5 teach     1858
 6 class     1738
 7 school    1606
 8 time      1457
 9 learn     1372
10 font      1311
# ℹ 9,991 more rows</code></pre>
</div>
</div>
</section>
</section>
</section>
</section>
<section id="model" class="level2">
<h2 class="anchored" data-anchor-id="model">3. MODEL</h2>
<p>In very simple terms, modeling involves developing a mathematical summary of a dataset. These summaries can help us further explore trends and patterns in our data.</p>
<p>In their book, <em>Learning Analytics Goes to School,</em> Krumm and Means (2018) describe two general types of modeling approaches used in the Data-Intensive Research workflow: unsupervised and supervised machine learning. In distinguishing between the two, they note:</p>
<blockquote class="blockquote">
<p><em>Unsupervised learning algorithms can be used to understand the structure of one’s dataset. Supervised models, on the other hand, help to quantify relationships between features and a known outcome. Known outcomes are also commonly referred to as labels or dependent variables.</em></p>
</blockquote>
<p>In Section 3 we focus on Topic Modeling, an unsupervised learning approach to automatically identify topics in a collection of documents. In fact, we’ll explore two different approaches to topic modeling, as well as strategies for identifying the “right” number of topics:</p>
<ol type="a">
<li><strong>Fitting a Topic Modeling with LDA</strong>. In this section we learn to use the <code>topicmodels</code> package and associated <code>LDA()</code> function for unsupervised classification of our forum discussions to find natural groupings of words, or topics. (the focus of zoom session)</li>
<li><strong>Fitting a Structural Topic Model</strong>. We then explore the use of the <code>stm</code> package and <code>stm()</code> function to fit our model and uses metadata about documents to improve the assignment of words to “topics” in a corpus.</li>
<li><strong>Choosing K.</strong> Finally, we wrap up Section 3 by learning about diagnostic properties like exclusivity, semantic coherence, and held out likelihood for helping to select an appropriate number of topics.</li>
</ol>
<section id="a.-fitting-a-topic-modeling-with-lda" class="level3">
<h3 class="anchored" data-anchor-id="a.-fitting-a-topic-modeling-with-lda">3a. Fitting a Topic Modeling with LDA</h3>
<p>Before running our first topic model using the <code>LDA()</code> function, let’s learn some basic principles behind Latent Dirichlet allocation and why LDA is of preferred over other automatic classification or clustering approaches.</p>
<p>Unlike simple forms of cluster analysis such as k-means clustering, LDA is a <strong>“mixture” model</strong>, which in our context means that:</p>
<ol type="1">
<li><strong>Every <u>document</u> contains a mixture of topics.</strong> Unlike algorithms like k-means, LDA treats each document as a mixture of topics, which allows documents to “overlap” each other in terms of content, rather than being separated into discrete groups. So in practice, this means that a discussion forum post could have an estimated topic proportion of 70% for Topic 1 (e.g.&nbsp;be mostly about a Topic 1), but also be partly about Topic 2.</li>
<li><strong>Every <u>topic</u> contains a mixture of words.</strong>&nbsp;For example, if we specified in our LDA model just 2 topics for our discussion posts, we might find that one topic seems to be about pedagogy while another is about learning. The most common words in the pedagogy topic might be “teacher”, “strategies”, and “instruction”, while the learning topic may be made up of words like “understanding” and “students”. However, words can be shared between topics and words like “statistics” or “assessment” might appear in both equally.</li>
</ol>
<p>Similar to k-means other other simple clustering approaches, however, LDA does require us to specify a value of <em>k</em> for the number of topics in our corpus. Selecting <em>k</em> is no trivial matter and can greatly impact your results.</p>
<p>Since we don’t have a have strong rationale about the number of topics that might exist in discussion forums, let’s use the <code>n_distinct()</code> function from the <code>dplyr</code> package to find the number of unique forum names in our course data and run with that:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">n_distinct</span>(ts_forum_data<span class="sc">$</span>forum_name)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 21</code></pre>
</div>
</div>
<p>Since it looks like there are 20 distinct discussion forums, we’ll use that as our value for the <code>k =</code> argument of the <code>LDA()</code>. Be patient while this runs, since the default setting of is to perform a large number of iterations.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">n_distinct</span>(ts_forum_data<span class="sc">$</span>forum_name)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 21</code></pre>
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>forums_lda <span class="ot">&lt;-</span> <span class="fu">LDA</span>(forums_dtm, </span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">k =</span> <span class="dv">20</span>, </span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">control =</span> <span class="fu">list</span>(<span class="at">seed =</span> <span class="dv">588</span>)</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>                  )</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>forums_lda</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>A LDA_VEM topic model with 20 topics.</code></pre>
</div>
</div>
<p>Note that we used the <code>control =</code> argument to pass a random number (<code>588</code>) to seed the assignment of topics to each word in our corpus. Since LDA is a <a href="https://machinelearningmastery.com/stochastic-in-machine-learning/">stochastic algorithm</a> that could have different results depending on where the algorithm starts, specified a <code>seed</code> for reproducibility and so we’re all seeing the same results every time we specify the same number of topics.</p>
</section>
<section id="b.-fitting-a-structural-topic-model" class="level3">
<h3 class="anchored" data-anchor-id="b.-fitting-a-structural-topic-model">3b. Fitting a Structural Topic Model</h3>
<p>Bail notes that LDA, while perhaps the most common approach to topic modeling, is just one of many different types, including Dynamic Topic Models, Correlated Topic Models, Hierarchical Topic Models, and more recently, Structural Topic Modeling (STM). He argues that one reason STM has rising in popularity and use is that it employs meta data about documents to improve the assignment of words to topics in a corpus and that can be used to examine relationships between covariates and documents.&nbsp;</p>
<p>Also, since Julia Silge has indicated that STM is, “my current favorite implementation of topic modeling in R” and has built supports in the <code>tidytext</code> package for building structural topic models, this package definitely is worth discussing in this walkthrough. I also highly recommend her own walkthrough of the <code>stm</code> package: <a href="https://juliasilge.com/blog/sherlock-holmes-stm/">The game is afoot! Topic modeling of Sherlock Holmes stories</a> as well as her follow up post, <a href="https://juliasilge.com/blog/evaluating-stm/">Training, evaluating, and interpreting topic models</a>.</p>
<section id="the-stm-package" class="level4">
<h4 class="anchored" data-anchor-id="the-stm-package">The <code>stm</code> Package</h4>
<p>As we’ve seen above, STM produced an unusual <code>temp</code> textProcessor output that is unique to the <code>stm</code> package. And as you’ve probably already guessed, the <code>stm()</code> function for fitting a structural topic model does not take a fairly standard document term matrix like the <code>LDA()</code> function.</p>
<p>Before we fit our model, we’ll have to extract the elements from the <code>temp</code> object created after we processed our text. Specifically, the <code>stm()</code> function expects the following arguments:</p>
<ul>
<li><code>documents =</code> the document term matrix to be modeled in the native stm format</li>
<li><code>data =</code> an optional data frame containing meta data for the prevalence and/or content covariates to include in the model</li>
<li><code>vocab =</code> a character vector specifying the words in the corpus in the order of the vocab indices in documents.</li>
</ul>
<p>Let’s go ahead and extract these elements:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>docs <span class="ot">&lt;-</span> temp<span class="sc">$</span>documents </span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>meta <span class="ot">&lt;-</span> temp<span class="sc">$</span>meta </span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>vocab <span class="ot">&lt;-</span> temp<span class="sc">$</span>vocab </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And now use these elements to fit the model using the same number of topics for <em>K</em> that we specified for our LDA topic model. Let’s also take advantage of the fact that we can include the <code>course_id</code> and <code>forum_id</code> covariates in the <code>prevealence =</code> argument to help improve, in theory, our model fit:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>forums_stm <span class="ot">&lt;-</span> <span class="fu">stm</span>(<span class="at">documents=</span>docs, </span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">data=</span>meta,</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">vocab=</span>vocab, </span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">prevalence =</span><span class="sc">~</span> course_id <span class="sc">+</span> forum_id,</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">K=</span><span class="dv">20</span>,</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">max.em.its=</span><span class="dv">25</span>,</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">verbose =</span> <span class="cn">FALSE</span>)</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>forums_stm</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>A topic model with 20 topics, 5781 documents and a 7820 word dictionary.</code></pre>
</div>
</div>
<p>As noted earlier, the <code>stm</code> package has a number of handy features. One of these is the <code>plot.STM()</code> function for viewing the most probable words assigned to each topic.</p>
<p>By default, it only shows the first 3 terms so let’s change that to 5 to help with interpretation:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot.STM</span>(forums_stm, <span class="at">n =</span> <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="lab-4-case-study_files/figure-html/plot-stm-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Note that you can also just use <code>plot()</code> as well:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(forums_stm, <span class="at">n =</span> <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="lab-4-case-study_files/figure-html/plot-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<section id="comprehension-check-3" class="level5">
<h5 class="anchored" data-anchor-id="comprehension-check-3">✅ Comprehension Check</h5>
<p>Fit a model for both LDA and STM using different values for K and answer the following questions:</p>
<ol type="1">
<li>What topics appear to be similar to those using 20 topics for K?</li>
<li>Knowing that you don’t have as much context as the researchers of this study do, how might you interpret one of these latent topics or themes using the key terms assigned?</li>
<li>What topic emerged that seem dramatically different and how might you interpret this topic?</li>
</ol>
</section>
</section>
</section>
<section id="c.-finding-k" class="level3">
<h3 class="anchored" data-anchor-id="c.-finding-k">3c. Finding <em>K</em></h3>
<p>As alluded to earlier, selecting the number of topics for your model is a non-trivial decision and can dramatically impact your results. Bail (2018) notes that</p>
<blockquote class="blockquote">
<p><em>The results of topic models should not be over-interpreted unless the researcher has strong theoretical apriori about the number of topics in a given corpus, or if the researcher has carefully validated the results of a topic model using both the quantitative and qualitative techniques described above.</em></p>
</blockquote>
<p>There are several approaches to estimating a value for K and we’ll take a quick look at one from the <code>ldatuning</code> package and one from our <code>stm</code> package.</p>
<section id="the-findtopicsnumber-function" class="level4">
<h4 class="anchored" data-anchor-id="the-findtopicsnumber-function">The FindTopicsNumber Function</h4>
<p>The <code>ldatuning</code> package has functions for both calculating and plotting different metrics that can be used to estimate the most preferable number of topics for LDA model. It also conveniently takes the standard document term matrix object that we created from out tidy text and has the added benefit of running fairly quickly, especially compared to the function for finding K from the <code>stm</code> package.</p>
<p>Let’s use the defaults specified in the <code>?FindTopicNumber</code> documentation and modify slightly get metrics for a sequence of topics from 10-75 counting by 5 and plot the output we saved using the <code>FindTopicsNumber_plot()</code> function:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>k_metrics <span class="ot">&lt;-</span> <span class="fu">FindTopicsNumber</span>(</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  forums_dtm,</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">topics =</span> <span class="fu">seq</span>(<span class="dv">10</span>, <span class="dv">75</span>, <span class="at">by =</span> <span class="dv">5</span>),</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">metrics =</span> <span class="st">"Griffiths2004"</span>,</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">"Gibbs"</span>,</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">control =</span> <span class="fu">list</span>(),</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">mc.cores =</span> <span class="cn">NA</span>,</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">return_models =</span> <span class="cn">FALSE</span>,</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">verbose =</span> <span class="cn">FALSE</span>,</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">libpath =</span> <span class="cn">NULL</span></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a><span class="fu">FindTopicsNumber_plot</span>(k_metrics)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note that the <code>FindTopicNumbers()</code> function contains three additional metrics for calculating metrics that can be used to estimate the most preferable number of topics for LDA model. We used the Griffiths2004 metrics included in the default example and I’ve also found this to produce the most interpretable results as show in the figure below:</p>
<p><img src="img/k_metrics.png" class="img-fluid" style="width:90.0%"></p>
<p>As a general rule of thumb and overly simplistic heuristic, we’re looking for an inflection point in our plot which indicates an optimal number of topics to select for a value of K.</p>
</section>
<section id="the-findingk-function" class="level4">
<h4 class="anchored" data-anchor-id="the-findingk-function">The findingK() Function</h4>
<p>Finally, Bail (2018) notes that the<code>stm</code> package has a useful function called <code>searchK</code> which allows us to specify a range of values for <code>k</code> and outputs multiple goodness-of-fit measures that are “very useful in identifying a range of values for <code>k</code> that provide the best fit for the data.”</p>
<p>The syntax of this function is very similar to the <code>stm()</code> function we used above, except that we specify a range for <code>k</code> as one of the arguments. In the code below, we search all values of&nbsp;<code>k</code>&nbsp;between 10 and 30.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co">#I am not expecting you run this code as it will take too long</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="co">#findingk &lt;- searchK(docs, </span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>                    <span class="co">#vocab, </span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>                    <span class="co">#K = c(5:15),</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>                    <span class="co">#data = meta, </span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>                    <span class="co">#verbose=FALSE)</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a><span class="co">#plot(findingk)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note that Running <code>searchK()</code> function on this corpus took all night on a pretty powerful MacBook Pro and crashed once as well, so I do not expect you to run this for the walkthrough. I ran a couple iterations and landed on between 5 and 15 with an optimal number of topics somewhere around 14:</p>
<p><img src="img/searchk_results.png" class="img-fluid" style="width:90.0%"></p>
<p>Given the somewhat conflicting results, also somewhat selfishly and for the same of simplicity for this walkthrough, I’m just going to stick with the rather arbitrary selection of 20 topics.</p>
</section>
<section id="the-ldavis-explorer" class="level4">
<h4 class="anchored" data-anchor-id="the-ldavis-explorer">The LDAvis Explorer</h4>
<p>One final tool that I want to introduce from the <code>stm</code> package is the <code>toLDAvis()</code> function which provides a great visualizations for exploring topic and word distributions using <code>LDAvis</code> topic browser:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">toLDAvis</span>(<span class="at">mod =</span> forums_stm, <span class="at">docs =</span> docs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required namespace: servr</code></pre>
</div>
</div>
<p>As you can see from the browser screen shot below, our current stm model of 20 topics is resulting in a lot of overlap among topics and suggest that 20 may not be an optimal number of topics, as other approaches for finding k also suggests:</p>
<p><img src="img/ldavis.png" class="img-fluid"></p>
</section>
</section>
</section>
<section id="explore" class="level2">
<h2 class="anchored" data-anchor-id="explore">4. EXPLORE</h2>
<p>Silge and Robinson (2018) note that fitting at topic model is the “easy part.” The hard part is making sense of the model results and that the rest of the analysis involves exploring and interpreting the model using a variety of approaches which we’ll walkthrough in in this section.</p>
<p>Bail (2018) cautions, however, that:</p>
<blockquote class="blockquote">
<p><em>…post-hoc interpretation of topic models is rather dangerous… and can quickly come to resemble the process of “reading tea leaves,” or finding meaning in patterns that are in fact quite arbitrary or even random.</em></p>
</blockquote>
<section id="a.-exploring-beta-values" class="level3">
<h3 class="anchored" data-anchor-id="a.-exploring-beta-values">4a. Exploring Beta Values</h3>
<p>Hidden within this <code>forums_lda</code> topic model object we created are per-topic-per-word probabilities, called β (“beta”). It is the probability of a term (word) belonging to a topic.&nbsp;</p>
<p>Let’s take a look at the 5 most likely terms assigned to each topic, i.e.&nbsp;those with the largest β values using the <code>terms()</code> function from the <code>topicmodels</code> package:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">terms</span>(forums_lda, <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     Topic 1  Topic 2      Topic 3    Topic 4      Topic 5   Topic 6     
[1,] "dice"   "resources"  "students" "statistics" "survey"  "stats"     
[2,] "fair"   "statistics" "kids"     "students"   "time"    "students"  
[3,] "trials" "teaching"   "nice"     "math"       "minutes" "class"     
[4,] "die"    "unit"       "idea"     "teaching"   "idea"    "ap"        
[5,] "rolls"  "mooc"       "standard" "teach"      "class"   "statistics"
     Topic 7      Topic 8     Topic 9         Topic 10 Topic 11    
[1,] "div"        "gapminder" "students"      "li"     "test"      
[2,] "science"    "students"  "questions"     "href"   "td"        
[3,] "statistics" "videos"    "understanding" "strong" "hypothesis"
[4,] "sharing"    "td"        "assessment"    "https"  "testing"   
[5,] "students"   "data"      "concepts"      "target" "sample"    
     Topic 12     Topic 13    Topic 14     Topic 15    Topic 16 Topic 17     
[1,] "students"   "questions" "students"   "data"      "font"   "students"   
[2,] "school"     "question"  "technology" "students"  "style"  "statistical"
[3,] "time"       "students"  "software"   "questions" "span"   "quot"       
[4,] "technology" "answer"    "time"       "sets"      "text"   "span"       
[5,] "middle"     "answers"   "data"       "collect"   "normal" "mind"       
     Topic 18   Topic 19 Topic 20  
[1,] "students" "data"   "students"
[2,] "sample"   "plots"  "data"    
[3,] "activity" "graph"  "task"    
[4,] "size"     "box"    "activity"
[5,] "lesson"   "class"  "tasks"   </code></pre>
</div>
</div>
<p>Even though we’ve somewhat arbitrarily selected the number of topics for our corpus, some these topics or themes are fairly intuitive to interpret. For example:</p>
<ul>
<li><p>Topic 11 (technology, students, software, program, excel) seems to be about students use of technology including software programs like excel;</p></li>
<li><p>Topic 9 (questions, kids, love, gapminder, sharing) seems to be about the gapminder activity from the MOOC-Ed and kids enjoyment of it; and</p></li>
<li><p>Topic 18 (data, students, collect, real, sets) seems to be about student collection and use of real world data sets.</p></li>
</ul>
<p>Not surprisingly, the <code>tidytext</code> package has a handy function conveniently name <code>tidy()</code> to convert our lda model to a tidy data frame containing these beta values for each term:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>tidy_lda <span class="ot">&lt;-</span> <span class="fu">tidy</span>(forums_lda)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>tidy_lda</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 272,400 × 3
   topic term       beta
   &lt;int&gt; &lt;chr&gt;     &lt;dbl&gt;
 1     1 2015  8.35e-281
 2     2 2015  1.06e-  3
 3     3 2015  7.92e- 45
 4     4 2015  5.72e- 67
 5     5 2015  3.00e- 31
 6     6 2015  5.38e- 36
 7     7 2015  4.06e- 34
 8     8 2015  1.02e- 33
 9     9 2015  1.10e-  4
10    10 2015  6.74e-  5
# ℹ 272,390 more rows</code></pre>
</div>
</div>
<p>Obviously, it’s not very easy to interpret what the topics are about from a data frame like this so let’s borrow code again from <a href="https://www.tidytextmining.com/nasa.html?q=beta#interpreting-the-topic-model">Chapter 8.4.3 Interpreting the topic model</a> in Text Mining with R to examine the top 5 terms for each topic and then look at this information visually:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>top_terms <span class="ot">&lt;-</span> tidy_lda <span class="sc">%&gt;%</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(topic) <span class="sc">%&gt;%</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(beta, <span class="at">n =</span> <span class="dv">5</span>, <span class="at">with_ties =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(topic, <span class="sc">-</span>beta)</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>top_terms <span class="sc">%&gt;%</span></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">term =</span> <span class="fu">reorder_within</span>(term, beta, topic)) <span class="sc">%&gt;%</span></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(topic, term) <span class="sc">%&gt;%</span>    </span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(beta)) <span class="sc">%&gt;%</span>  </span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(beta, term, <span class="at">fill =</span> <span class="fu">as.factor</span>(topic))) <span class="sc">+</span></span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_reordered</span>() <span class="sc">+</span></span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Top 5 terms in each LDA topic"</span>,</span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="fu">expression</span>(beta), <span class="at">y =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> topic, <span class="at">ncol =</span> <span class="dv">4</span>, <span class="at">scales =</span> <span class="st">"free"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="lab-4-case-study_files/figure-html/top_terms-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="b.-exploring-gamma-values" class="level3">
<h3 class="anchored" data-anchor-id="b.-exploring-gamma-values">4b. Exploring Gamma Values</h3>
<p>Now that we have a sense of the most common words associated with each topic, let’s take a look at the topic prevalence in our MOOC-Ed discussion forum corpus, including the words that contribute to each topic we examined above.</p>
<p>Also, hidden within our <code>forums_lda</code> topic model object we created are per-document-per-topic probabilities, called γ (“gamma”). This provides the probabilities that each document is generated from each topic, that gamma matrix. We can combine our beta and gamma values to understand the topic prevalence in our corpus, and which words contribute to each topic.</p>
<p>To do this, we’re going to borrow some code from the Silge (2018) post, <a href="https://juliasilge.com/blog/evaluating-stm/">Training, evaluating, and interpreting topic models</a>.</p>
<p>First, let’s create two tidy data frames for our beta and gamma values</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>td_beta <span class="ot">&lt;-</span> <span class="fu">tidy</span>(forums_lda)</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>td_gamma <span class="ot">&lt;-</span> <span class="fu">tidy</span>(forums_lda, <span class="at">matrix =</span> <span class="st">"gamma"</span>)</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>td_beta</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 272,400 × 3
   topic term       beta
   &lt;int&gt; &lt;chr&gt;     &lt;dbl&gt;
 1     1 2015  8.35e-281
 2     2 2015  1.06e-  3
 3     3 2015  7.92e- 45
 4     4 2015  5.72e- 67
 5     5 2015  3.00e- 31
 6     6 2015  5.38e- 36
 7     7 2015  4.06e- 34
 8     8 2015  1.02e- 33
 9     9 2015  1.10e-  4
10    10 2015  6.74e-  5
# ℹ 272,390 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>td_gamma</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 115,320 × 3
   document topic    gamma
   &lt;chr&gt;    &lt;int&gt;    &lt;dbl&gt;
 1 11295        1 0.00192 
 2 12711        1 0.000243
 3 12725        1 0.0259  
 4 12733        1 0.00224 
 5 12743        1 0.00761 
 6 12744        1 0.00383 
 7 12756        1 0.0259  
 8 12757        1 0.00282 
 9 12775        1 0.00282 
10 12816        1 0.00282 
# ℹ 115,310 more rows</code></pre>
</div>
</div>
<p>Next, we’ll adopt Julia’s code wholesale to create a filtered data frame of our <code>top_terms</code>, join this to a new data frame for <code>gamma-terms</code> and create a nice clean table using the <code>kabel()</code> function <code>knitr</code> package:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>top_terms <span class="ot">&lt;-</span> td_beta <span class="sc">%&gt;%</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(beta) <span class="sc">%&gt;%</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(topic) <span class="sc">%&gt;%</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">top_n</span>(<span class="dv">7</span>, beta) <span class="sc">%&gt;%</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="sc">-</span>beta) <span class="sc">%&gt;%</span></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(topic, term) <span class="sc">%&gt;%</span></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">terms =</span> <span class="fu">list</span>(term)) <span class="sc">%&gt;%</span></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">terms =</span> <span class="fu">map</span>(terms, paste, <span class="at">collapse =</span> <span class="st">", "</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: `cols` is now required when using `unnest()`.
ℹ Please use `cols = c(terms)`.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>gamma_terms <span class="ot">&lt;-</span> td_gamma <span class="sc">%&gt;%</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(topic) <span class="sc">%&gt;%</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">gamma =</span> <span class="fu">mean</span>(gamma)) <span class="sc">%&gt;%</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(gamma)) <span class="sc">%&gt;%</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(top_terms, <span class="at">by =</span> <span class="st">"topic"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">topic =</span> <span class="fu">paste0</span>(<span class="st">"Topic "</span>, topic),</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">topic =</span> <span class="fu">reorder</span>(topic, gamma))</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>gamma_terms <span class="sc">%&gt;%</span></span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(topic, gamma, terms) <span class="sc">%&gt;%</span></span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">digits =</span> <span class="dv">3</span>, </span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Topic"</span>, <span class="st">"Expected topic proportion"</span>, <span class="st">"Top 7 terms"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 8%">
<col style="width: 23%">
<col style="width: 68%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Topic</th>
<th style="text-align: right;">Expected topic proportion</th>
<th style="text-align: left;">Top 7 terms</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Topic 4</td>
<td style="text-align: right;">0.087</td>
<td style="text-align: left;">statistics, students, math, teaching, teach, school, level</td>
</tr>
<tr class="even">
<td style="text-align: left;">Topic 2</td>
<td style="text-align: right;">0.080</td>
<td style="text-align: left;">resources, statistics, teaching, unit, mooc, ideas, learning</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Topic 9</td>
<td style="text-align: right;">0.079</td>
<td style="text-align: left;">students, questions, understanding, assessment, concepts, test, statistical</td>
</tr>
<tr class="even">
<td style="text-align: left;">Topic 6</td>
<td style="text-align: right;">0.078</td>
<td style="text-align: left;">stats, students, class, ap, statistics, school, math</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Topic 15</td>
<td style="text-align: right;">0.078</td>
<td style="text-align: left;">data, students, questions, sets, collect, question, real</td>
</tr>
<tr class="even">
<td style="text-align: left;">Topic 20</td>
<td style="text-align: right;">0.070</td>
<td style="text-align: left;">students, data, task, activity, tasks, question, cycle</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Topic 14</td>
<td style="text-align: right;">0.064</td>
<td style="text-align: left;">students, technology, software, time, data, agree, real</td>
</tr>
<tr class="even">
<td style="text-align: left;">Topic 13</td>
<td style="text-align: right;">0.059</td>
<td style="text-align: left;">questions, question, students, answer, answers, correct, results</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Topic 8</td>
<td style="text-align: right;">0.053</td>
<td style="text-align: left;">gapminder, students, videos, td, data, video, site</td>
</tr>
<tr class="even">
<td style="text-align: left;">Topic 12</td>
<td style="text-align: right;">0.049</td>
<td style="text-align: left;">students, school, time, technology, middle, video, student</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Topic 3</td>
<td style="text-align: right;">0.045</td>
<td style="text-align: left;">students, kids, nice, idea, standard, understand, language</td>
</tr>
<tr class="even">
<td style="text-align: left;">Topic 18</td>
<td style="text-align: right;">0.038</td>
<td style="text-align: left;">students, sample, activity, size, lesson, data, results</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Topic 17</td>
<td style="text-align: right;">0.038</td>
<td style="text-align: left;">students, statistical, quot, span, mind, level, reasoning</td>
</tr>
<tr class="even">
<td style="text-align: left;">Topic 11</td>
<td style="text-align: right;">0.033</td>
<td style="text-align: left;">test, td, hypothesis, testing, sample, difference, results</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Topic 7</td>
<td style="text-align: right;">0.033</td>
<td style="text-align: left;">div, science, statistics, sharing, students, love, http</td>
</tr>
<tr class="even">
<td style="text-align: left;">Topic 19</td>
<td style="text-align: right;">0.030</td>
<td style="text-align: left;">data, plots, graph, box, class, median, plot</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Topic 10</td>
<td style="text-align: right;">0.030</td>
<td style="text-align: left;">li, href, strong, https, target, _blank, statistics</td>
</tr>
<tr class="even">
<td style="text-align: left;">Topic 16</td>
<td style="text-align: right;">0.023</td>
<td style="text-align: left;">font, style, span, text, normal, 0px, color</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Topic 5</td>
<td style="text-align: right;">0.020</td>
<td style="text-align: left;">survey, time, minutes, idea, class, semester, student</td>
</tr>
<tr class="even">
<td style="text-align: left;">Topic 1</td>
<td style="text-align: right;">0.014</td>
<td style="text-align: left;">dice, fair, trials, die, rolls, rolling, unfair</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>And let’s also compare this to the most prevalent topics and terms from our <code>forums_stm</code> model that we created using the <code>plot()</code> function:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(forums_stm, <span class="at">n =</span> <span class="dv">7</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="lab-4-case-study_files/figure-html/plot_stm-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="c.-reading-the-tea-leaves" class="level3">
<h3 class="anchored" data-anchor-id="c.-reading-the-tea-leaves">4c. Reading the Tea Leaves</h3>
<p>Recognizing that topic modeling is best used as a “tool for reading” and provides only an incomplete answer to our overarching, <strong>“How do we quantify what a corpus is about?”</strong>, the results do suggest some potential topics that have emerges as well as some areas worth following up on.</p>
<p>Specifically, looking at some of the common clusters of words for the more prevalent topics suggest that some key topics or “latent themes” (renamed in bold) might include:</p>
<ul>
<li><strong>Teaching Statistics:</strong> Unsurprising, given the course title, the topics most prevalent in both the <code>forums_stm</code> and <code>forums_lda</code> models contains the terms “teach”, “students”, “statistics”. This could be an “overarching theme” but more likely may simply be just the residue of the course title though being sprinkled throughout the forums and deserves some follow up. Topics 8 from the LDA model may overlap with this topic as well.</li>
<li><strong>Course Utility:</strong> The second most prevalent Topics (13 and 2) in the <code>lda</code> and <code>stm</code> models respectively, seem to potentially be about the usefulness of course “resources” like lessons, tools, videos, and activities. I’m wagering this might be a forum dedicated to course feedback. Topic 15 from the STM model also suggest this may be a broader theme.</li>
<li><strong>Using Real-World Data:</strong> Topics 18 &amp; 12 from the LDA model particularly intrigue me and I’m wagering this is pretty positive sentiment among participants about the value and benefit of having students collect and analyze real data sets (e.g.&nbsp;Census data in Topic 1) and work on projects relevant to their real life. Will definitely follow up on this one.</li>
<li><strong>Technology Use:</strong> Several topics (6 &amp; 11 from LDA and 8 &amp; 19 from STM) appear to be about student use of technology and software like calculators and Excel for teaching statistics and using simulations. Topic 16 from LDA also suggest the use of the Common Online Data Analysis Platform (<a href="Common%20Online%20Data%20Analysis%20Platform%20(CODAP)%20Open-source%20software%20for%20dynamic%20data%20exploration">CODAP</a>).</li>
<li><strong>Student Struggle &amp; Engagement:</strong> Topic 15 from LDA and Topic 16 from STM also intrigue me and appear to be two opposite sides of perhaps the same coin. The former includes “struggle” and “reading” which suggests perhaps a barrier to teaching statistics while Topic 16 contains top stems like “engage”, “activ”, and “think” and may suggest participants anticipate activities may engage students.</li>
</ul>
<p>To serve as a check on my tea leaf reading, I’m going to follow Bail’s recommendation to examine some of these topics qualitatively. The <code>stm</code> package has another useful function though exceptionally fussy function called <code>findThoughts</code> which extracts passages from documents within the corpus associate with topics that you specify.</p>
<p>The first line of code may not be necessary for your independent analysis, but because the <code>textProcessor()</code> function removed several documents during processing, the <code>findthoughts()</code> function can’t properly index the processed docs. This <a href="https://stackoverflow.com/questions/43492667/r-stm-number-of-provided-texts-and-number-of-documents-modeled-do-not-match">line of code found on stackoverflow</a> removes documents from original <code>ts_forum_data</code> source that were removed during processing so there is a one-to-one correspondence with <code>forums_stm</code> and so you can use the function to find posts associated with a given topic.</p>
<p>Let’s slightly reduce our original data set to match our STM model, pass both to the <code>findThoughts()</code> function, and set our arguments to return <code>n =10</code> posts from <code>topics = 2</code> (i.e.&nbsp;Topic 2) that have at least 50% or <code>thresh = 0.5</code> as a minimum threshold for the estimated topic proportion.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>ts_forum_data_reduced <span class="ot">&lt;-</span>ts_forum_data<span class="sc">$</span>post_content[<span class="sc">-</span>temp<span class="sc">$</span>docs.removed]</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a><span class="fu">findThoughts</span>(forums_stm,</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">texts =</span> ts_forum_data_reduced,</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">topics =</span> <span class="dv">2</span>, </span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>             <span class="at">n =</span> <span class="dv">10</span>,</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>             <span class="at">thresh =</span> <span class="fl">0.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
 Topic 2: 
     Here is a cool video with Hans Rosling  using Gapminder. It's pretty cool.  https://www.youtube.com/watch?v=jbkSRLYSojo
    Thank you for sharing the link!!!  I think that this is the document that Chris mentions co-writing and being ready for NCTM's National Conference in San Francisco this April. :-)
    Yes  thank you! The site was an excellent resource  especially for someone like myself who is new to this stuff!
    I've never heard of FiveThirtyEight  could you tell me more about the resource?     Thanks!  Carisa
    QELP looks so cool! Thanks for sharing!
    Thanks for letting us know about this TED talk!  I watched the one about Ignorance and found Hans Rosling so entertaining that I ended up finding other TED talks he has done and watched them for way too long last night.
    Wow!  I totally agree with you.  The Gapminder was great.  Also  I was inspired to complete this unit as well.  I did not know there was a TedTalk about this.  I will have to check it out.
    Wow!  I totally agree with you.  The Gapminder was great.  Also  I was inspired to complete this unit as well.  I did not know there was a TedTalk about this.  I will have to check it out.
    I love your idea of using this as a STEM night project.  Thank you for the thought...I will have to steal it :)  Eren
    Hi Regina   I really like the gapminder site.  There are some great video on the gapminder site that I have used in my courses. Hans Rosling  founder of gapminder  also has some really great TED talks.  Sadly he passed away this year.      My interests have been peaked by the Locus site.  I think there is a lot of potential there for use in my classroom too.     Good luck!     Shar</code></pre>
</div>
</div>
<p>Duplicate posts aside, this <strong>Course Utility</strong> topic returns posts there were expected based on my interpretation of the key terms for Topic 2. It looks like I may have read those tea leaves correctly.</p>
<p>Now let’s take a look at Topic 16 that we thought might be related to student engagement:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">findThoughts</span>(forums_stm,</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">texts =</span> ts_forum_data_reduced,</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">topics =</span> <span class="dv">16</span>, </span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">n =</span> <span class="dv">10</span>,</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">thresh =</span> <span class="fl">0.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
 Topic 16: 
     Hi Folks   One of the discussions that needs to occur when studying the travel time of walking vs. driving by car vs riding on a school bus is the number of stops the bus must make in order to pick up students.  One of my previous careers was that of a school bus driver.  At each stop I was required to stop the bus  put on the flashing lights  put on the emergency brake  look through all of the mirrors to determine all of the cars had stopped  open the bus door  then pick up the microphone (which could be heard inside and outside of the bus) to tell the students it was now safe to cross the road and enter the bus.  After waiting for all students to get on the bus and take a seat and for the bus monitor to check under the bus and get on the bus again; I would then close the bus door and take off the emergency brake.  Next  I would check all of my mirrors to make sure it was safe pull completely back into the lane of travel and continue on my bus route. All of these actions increased the amount of time it took to get to school.  What is the purpose of this investigation?  I would want to know if the students with the longer travel time to and from school are impacted by the amount of time spent traveling each day.  What are the grades of the students with the longest travel time how do those grades compare to students with the least travel time? What behaviors are exhibited by students in school who spend the most time traveling to and from school? Are they more likely to exhibit behaviors that result in disciplinary referrals? Does travel time negatively impact the academic and behavioral performance of these students in school? On the flip slide  does longer travel time provide the opportunity for students to engage in preferred activities of talking to their friends on the bus or engaging in their electronic device to listen to music or play games and does this provide a beginning and end of the day relaxation experience for the students. Do these students have better grades and less disciplinary referrals?
    This is a great activity and can have so many variations.  It doesn't have to be Pepsi vs. Coke if you don't have a lot of pop drinkers in class.  You can do a name brand vs. generic orange juice or even a taste test with chips or cookies (perhaps blind folds would be necessary for food tasting).  I also think one of the best follow-up discussions is about how many students actually prefer what they claim to prefer.  Having the preference beforehand definitely enriches the discussions.
    I agree and oftentimes do a blindfolded taste test with name brand Oreo cookies and then a store brand cookie. I follow a similar method as the Coke vs. Pepsi one  but tweak it a bit for AP Statistics. It is fun to see the looks on kids faces when they \choose\" the generic Oreo because they are just so sure they knew the Oreo! Every time I've done this experiment  there seems to be no clear evidence students prefer Oreos :) "
    We do which is different out of three as well  we also have 6 different combinations and randomly assign students to the combinations (ex coke Pepsi  pepsi  c p c  coke coke pepsi  etc)
    My colleagues have commented on the Pepsi versus Coke activity. I also commented in there but liked to expand the concept further. When students are involved in an activity  they make it there own and really would make it worth their while. Hence when they actually made the data happen  being instrumental in not only choosing which brand to anonymously be named and tasted  to collating the results  the students learn how to make data collection impartial  objective and representative. Also  they see the process of good data collection by the randomness it was done  such that whatever result would really represent a preference for a brand without any prior bias.   So  the students learn to collect and collate data and results in as objective and unbiased manner  such that results are untainted and would truly represent a true preference and not a directed preference through a prior bias. Though it would take a lot of time  yet the lessons learned on how data is done and collected and collated was worth its while in the lesson it has rendered.
    I have used a similar task comparing bottled water versus tap water  or two brands/types of bottled water and it worked pretty well. Sometimes it was interesting to see where students could not tell the difference between tap water and bottled water.
    I have done this one as well and it went great.  Another version I do is name brand and store brand cookies.  Fudge stripes or chips a hoy cookies work great.
    I have done this one in class with approximately 20 students.  Instead of picking which is which  I ask which one is different out of three samples.  We design the experiment together and talk about the random assignment of the odd ball drink in which cup  consistency in pouring  color  smell  how to blind the experiment  ect.  We then look at our data and compare it to a simulation to see if we have more \skill\" than randomly guessing.  This helps create a smoother transition between simulations and experiments.  I have also used different drinks  most recently blue Gatorade vs Blue Powerade.  Smell and color were factors we had trouble controlling.    "
    I've seen bottled water vs. tap water too
    Hi Erik   When I was in school  we did a similar activity except that we used regular bags of M&amp;amp;Ms to determine which color is the most common for M&amp;amp;M's.  Using skittles would be similar.  You could also extend this to see if the type of M&amp;amp;M changes the predominant color - plain vs. peanut vs. ? (there are so many varieties now!).</code></pre>
</div>
</div>
<p>It looks like my tea reading was a partially correct for Topic 16, though the results seem to be about a specific “Pepsi challenge” activity to conduct with students.</p>
<p>Finally, let’s look at posts from Topic 3 which we though might be an overarching theme about teaching statistics:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>ts_forum_data_reduced <span class="ot">&lt;-</span>ts_forum_data<span class="sc">$</span>post_content[<span class="sc">-</span>temp<span class="sc">$</span>docs.removed]</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a><span class="fu">findThoughts</span>(forums_stm,</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">texts =</span> ts_forum_data_reduced,</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">topics =</span> <span class="dv">3</span>, </span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>             <span class="at">n =</span> <span class="dv">10</span>,</span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>             <span class="at">thresh =</span> <span class="fl">0.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
 Topic 3: 
     I really like the \Gummy Bears in Space\" activity and I can think of different ways to incorporate this into my 7th grade classroom. I think this would be a great hands on activity to get a STEM or science teacher involved to integrate different subjects into a lesson. "
    I agree about them working together.  I never have students work independently on these sorts of tasks.  It is a richer experience when the conversations can occur about the work being done.
    Motivating the students to be interested to learn the material is a big push for me this year.  As others stated  we as teachers have to be motivated in order for our students to be motivated.  I spend a lot of time trying to make my lessons fun and interactive because I know if the students are engaged they will take away more.  Some topics are easier than others.  Just like it's easier to incorporate real world situations with some topics and not others.  I have discovered that once I got the mindset of making them interesting more students was becoming successful on the lesson.
    I agree also that listening is beneficial for both students and teachers.  The students can hear samples of mathematical/statistical thinking going on...like a \think aloud.\"  We need to continually model the thinking process for them  and these videos help to show the progression of thinking.  It is also helpful for us as teachers to see the directions that student minds are going so that we can encourage them to make even more progress by taking their thinking to the next level. "
    Oh yeah. Without a doubt the introduction of the SASI framework was the most useful part of the MOOC for me too. I will definitely be administering this framework in my Statistics classes until it becomes second nature for my students that every time they're thinking about anything statistically significant that they consider the framework in mind.
    I agree that the framework is very useful and I would also like to see lessons created that specifically address each aspect of the framework. These lessons would be used to develop a strong expertise with each aspect using a whole-part-whole instructional method. Teach the SASI framework as a whole  then break it down into the 4 parts and practice those skills  then go back to completing a whole project. The quality of student work may improve with this teaching progression.
    I also really loved the gummy bear activity idea. I think that my third graders would also really enjoy an activity like this  although they would probably eat the gummy bears. I think it would be a great way for them to get more involved in the lesson.
    I agree with the point you made Drew. The discussions made it feel like you were connected with other people and it gave us different ways to look at the particular subject. It gave someone like me  who isn't as experienced in statistics  viewpoints and thinking strategies from people who are \experts\" in the field.  "
    I really like the war game activity. It is a game that your student are probably going to know how to play already  which should help you when explaining. Also it can really get your students up and going and you will see the competitiveness really kick in with your students. I also like the discussion part you have with it as well because in reality who really knows which deck of cards is going to be the best to pick from  so this makes a great topic for discussion and it would be interesting to see what all of your students say. Overall I would have to say you did a great job with your project here. The only way I can see for adjustments though would be after you do your activities the first time because you really don't know how things are going to work out until you actually try them yourself.
    I don't know that it is fair to say that they don't want to think and are just looking for formulas. I think in the past this has been their experience though and so they want to fall back on what they know. Hopefully MOOCs like this as well as the common core curriculum should be driving the \thinking\" end of things a little more than ever before. I know I have already started to see a difference in the thinking skills of my students if not their math skills and this is a exciting for my future as a math educator. The experts in the video talk about how collecting and analyzing real world data is engaging for kids because it isn't a worksheet that is disconnected from their lives. I think this engagement necessarily forces them to think which is way more fun than being a formula robot. Anecdotally  my brother woke me up this week with an interesting geometry problem that made me think about circles in a new way and it was really exciting. Granted  as a math teacher I'm probably to the point where I can be excited about thinking about weird problems but I know that balancing my budget is significantly less exciting that solving weird problems that make me think.  Lon story short- I think if we are engaging students with interesting problems they will be practicing thinking skills  if we drive class discussions with metacognition they will be practicing thinking skills  if we have students pose their own problems that are relevant to their lives they will be practicing thinking skills. If we can make a nation of critical thinkers and problem solvers  there should be no limit to what we can accomplish.   "</code></pre>
</div>
</div>
<p>Looking at just the 10 posts returned, perhaps a better name for this topic would be <strong>Course Reflections on Teaching Statistics</strong>.</p>
<section id="takeaway" class="level4">
<h4 class="anchored" data-anchor-id="takeaway">Takeaway</h4>
<p>In addition to some useful R packages and functions for the actual process of topic modeling, hopefully there are two main lessons I’m hoping you take away from this walkthrough:</p>
<ol type="1">
<li><strong>Topic modeling requires a lot of decisions.</strong> Beyond deciding on a value for K, there are a number of key decisions that you have to make that can dramatically affect your results. For example, to stem or not to stem? What qualifies as a document? What flavor or topic modeling is best suited to your data and research questions? How many iterations to run?</li>
<li><strong>Topic modeling is as much art as (data) science.</strong> As Bail (2018) noted, the term “topic” is somewhat ambitious, and topic models do not produce highly nuanced classification of texts. Once you’ve fit your model, interpreting your model requires some mental gymnastics and ideally some knowledge of the context from which the data came to help with interpretation of your topics. Moreover, the quantitative approaches for making the decisions highlighted above are imperfect and a good deal of human judgment required.</li>
</ol>
<section id="comprehension-check-4" class="level5">
<h5 class="anchored" data-anchor-id="comprehension-check-4">✅ Comprehension Check</h5>
<p>Using the STM model you fit from the Section 3 [Comprehension Check] with a different value for K, use the approaches demonstrated in Section 4 to explore and interpret your topics and terms and revisit the following question:</p>
<ol type="1">
<li>Now that you have a little more context, how might you revise your initial interpretation of some of the latent topics or latent themes from your model?</li>
</ol>
</section>
</section>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>